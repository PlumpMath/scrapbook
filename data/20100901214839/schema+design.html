<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>


<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">



            <title>Schema Design - MongoDB</title>
    
        
        
        
        
        

                        
    
    
            
<meta id="confluence-context-path" name="confluence-context-path" content="">
<meta id="atlassian-token" name="atlassian-token" content="yhfQmnp0a3">
<meta id="confluence-space-key" name="confluence-space-key" content="DOCS">



    

<!-- include system resources -->

<!--[if IE]>
<link type="text/css" rel="stylesheet" href="/s/1627/3/1.0/_/download/batch/confluence.web.resources:master-styles/confluence.web.resources:master-styles.css?ieonly=true" media="all"/>
<![endif]-->





<!--[if IE]>
<link type="text/css" rel="stylesheet" href="/s/1627/3/1.0/_/download/batch/confluence.macros.profile:profile-macro-styles/confluence.macros.profile:profile-macro-styles.css?ieonly=true" media="all"/>
<![endif]-->



















<!--[if IE]>
<link type="text/css" rel="stylesheet" href="/s/1627/3/1.0/_/download/batch/confluence.web.resources:comments/confluence.web.resources:comments.css?ieonly=true" media="all"/>
<![endif]-->







<!--[if IE]>
<link type="text/css" rel="stylesheet" href="/s/1627/3/1.0.2/_/download/batch/com.atlassian.auiplugin:dialog/com.atlassian.auiplugin:dialog.css?ieonly=true" media="all"/>
<![endif]-->






<!--[if IE]>
<link type="text/css" rel="stylesheet" href="/s/1627/3/1.0/_/download/batch/confluence.web.resources:userlink/confluence.web.resources:userlink.css?ieonly=true" media="all"/>
<![endif]-->




<!-- end system resources -->

    

    <meta name="confluence-request-time" content="1283349222263">

    <link rel="shortcut icon" href="favicon.ico">
    <link rel="icon" type="image/png" href="confluence_16.png">

<link rel="search" type="application/opensearchdescription+xml" href="http://www.mongodb.org/opensearch/osd.action" title="10gen Confluence">

    
        
        
    
    <link rel="shortcut icon" href="favicon_001.ico">  

<link rel="stylesheet" type="text/css" href="schema+design.css" media="all">
</head><body id="com-atlassian-confluence">
    


    

        
  
    


  <div id="top-right">
    <div class="user-right">
    <ul id="header-menu-bar" class="ajs-menu-bar">
                    
        
            <li class="normal ajs-menu-item">
        <a id="browse-menu-link" class="browse trigger ajs-menu-title" href="#"><span><span>Browse</span></span></a>         <div class="hidden ajs-drop-down">
                        <ul id="browse-menu-link-leading" class="section-leading first">
                                        <li>
    
    <a id="space-pages-link" href="http://www.mongodb.org/pages/listpages.action?key=DOCS" class="" title="Attachments: 1">
                   <span>Pages</span>            </a>
</li>
                                        <li>
    
    <a id="space-blogposts-link" href="http://www.mongodb.org/pages/viewrecentblogposts.action?key=DOCS" class="" title="Attachments: 1">
                   <span>News</span>            </a>
</li>
                                        <li>
    
    <a id="space-labels-link" href="http://www.mongodb.org/labels/listlabels-heatmap.action?key=DOCS" class="" title="Attachments: 1">
                   <span>Labels</span>            </a>
</li>
                                        <li>
    
    <a id="space-attachments-link" href="http://www.mongodb.org/spaces/listattachmentsforspace.action?key=DOCS" class="" title="Attachments: 1">
                   <span>Attachments</span>            </a>
</li>
                                        <li>
    
    <a href="http://www.mongodb.org/spaces/space-bookmarks.action?spaceKey=DOCS" class="" title="Attachments: 1">
                   <span>Bookmarks</span>            </a>
</li>
                                        <li>
    
    <a id="space-mail-link" href="http://www.mongodb.org/spaces/viewmailarchive.action?key=DOCS" class="" title="Attachments: 1">
                   <span>Mail</span>            </a>
</li>
                                        <li>
    
    <a id="space-advanced-link" href="http://www.mongodb.org/spaces/viewspacesummary.action?key=DOCS" class="" title="Attachments: 1">
                   <span>Advanced</span>            </a>
</li>
                            </ul>
                    </div>
    </li>
        
                                                         <li class="ajs-menu-item normal">
    
    <a id="login-link" href="http://www.mongodb.org/login.action?os_destination=%2Fdisplay%2FDOCS%2FSchema%2BDesign" class="user-item login-link">
                   <span>Log In</span>            </a>
</li>
                            </ul>
    </div>
  </div>
  

      <div class="search-db">
      <form id="quick-search" class="quick-search" method="get" action="http://www.mongodb.org/dosearchsite.action">
                <fieldset>
            <legend>Quick Search</legend>
            <input value="" class="quick-search-query" id="quick-search-query" accesskey="q" autocomplete="off" name="queryString" size="25" type="text">
            <input class="quick-search-submit" id="quick-search-submit" value="Search" type="submit">
        </fieldset>
        <fieldset class="hidden parameters">
            <input class="quickSearchPlaceholder" id="quickSearchPlaceholder" value="Search" type="hidden">

            <input id="quickNavEnabled" value="true" type="hidden">
             <!-- Quick nav disabled. SettingsManager could not be found -->         </fieldset>
    </form>
      </div>  


  <div id="header-db" class="spread">
    <div class="split">
    	<div id="logo">
    		<div><a href="http://www.mongodb.org/"><img src="logo-mongodb.png" alt="mongoDB" height="90" width="217"></a></div>
    	</div>
    	<div id="nav">
    	</div>
    </div>
  </div>

  <div id="breadcrumbsback" class="spread">
    <div class="split">

    
    <ol id="breadcrumbs">
                                                
            <li><span>
                                                    <a href="http://www.mongodb.org/display/DOCS">MongoDB</a>
                        </span></li>
                                                                    <li id="ellipsis" title="    …
                    Home
        …"><span><strong>…</strong></span></li>
                                                
            <li class="hidden-crumb"><span>
                                                    <a indepth="true" href="home.html">Home</a>
                        </span></li>
                                            
            <li><span>
                                                    <a indepth="true" href="index.html">Developer Zone</a>
                        </span></li>
                                            
            <li><span>
                                                    <a indepth="true" href="manual.html">Manual</a>
                        </span></li>
                                            
            <li><span>
                                                    <a indepth="true" href="inserting.html">Inserting</a>
                        </span></li>
                                            
            <li><span>
                                                    Schema Design
                        </span></li>
                </ol>
 
    </div>
  </div>

  <div id="main-db" class="spread">
    <div class="split">
    
                <ul id="user-control-panel">
                                
            <li class="first"><a href="http://www.mongodb.org/login.action?os_destination=%2Fdisplay%2FDOCS%2FSchema%2BDesign">Log In</a></li>

                                                        </ul>
        <div>
    
    <div id="navigation" class="content-navigation view">
        <fieldset class="hidden parameters">
            <input id="pageId" value="131465" type="hidden">
        </fieldset>
        <ul class="ajs-menu-bar">
                                
            <li class="normal ajs-menu-item">
        <a id="add-menu-link" class="add trigger ajs-menu-title" href="#"><span><span>Add</span></span></a>         <div class="hidden ajs-drop-down">
                        <ul id="add-menu-link-page" class="section-page first">
                                        <li>
    
    <a id="add-comment-menu-link" href="http://www.mongodb.org/display/DOCS/Schema+Design?showComments=true&amp;showCommentArea=true#addcomment" class="add-comment">
                   <span>Comment</span>            </a>
</li>
                            </ul>
                    </div>
    </li>
                    
            <li class="normal ajs-menu-item">
        <a id="action-menu-link" class="action trigger ajs-menu-title" href="#"><span><span>Tools</span></span></a>         <div class="hidden ajs-drop-down">
                        <ul id="action-menu-link-primary" class="section-primary first">
                                        <li>
    
    <a id="view-attachments-link" href="http://www.mongodb.org/pages/viewpageattachments.action?pageId=131465" class="action-view-attachments" accesskey="a">
                   <span><u>A</u>ttachments (1)</span>            </a>
</li>
                                        <li>
    
    <a id="action-view-history-link" href="http://www.mongodb.org/pages/viewpreviousversions.action?pageId=131465" class="action-view-history">
                   <span>Page History</span>            </a>
</li>
                            </ul>
                        <ul id="action-menu-link-secondary" class="section-secondary">
                                        <li>
    
    <a id="view-page-info-link" href="http://www.mongodb.org/pages/viewinfo.action?pageId=131465" class="action-view-info" accesskey="i">
                   <span><u>I</u>nfo</span>            </a>
</li>
                                        <li>
    
    <a id="action-view-source-link" href="http://www.mongodb.org/pages/viewpagesrc.action?pageId=131465" class="action-view-source popup-link">
                   <span>View Wiki Markup</span>            </a>
</li>
                                        <li>
    
    <a href="http://www.mongodb.org/spaces/flyingpdf/pdfpageexport.action?pageId=131465&amp;atl_token=yhfQmnp0a3" class="">
                   <span>Export to PDF</span>            </a>
</li>
                                        <li>
    
    <a id="action-export-word-link" href="http://www.mongodb.org/exportword?pageId=131465" class="action-export-word">
                   <span>Export to Word</span>            </a>
</li>
                            </ul>
                    </div>
    </li>
            </ul>
    </div>

    </div>
    <h1 id="title-heading" class="pagetitle">
                            
		<span id="title-text">
					            <a indepth="true" href="schema+design.html">Schema Design</a>
    				</span>
    </h1>

    <!--
    Root decorator: this is a layer of abstraction that Confluence doesn't need. It will be removed eventually.
-->




    
    

    
    
        
    
    
                    
    



        
<div id="content" class="page view">
            
        
                        
                                
    
        
                    
        
                

 
<table cellpadding="5" cellspacing="2">
<tbody><tr>
<td class="pagecontent" align="left" valign="top" width="78%">
<div class="wiki-content">
<!-- wiki content -->
            <div>
<ul>
    <li><a href="#SchemaDesign-Introduction">Introduction</a></li>
    <li><a href="#SchemaDesign-Embedvs.Reference">Embed vs. Reference</a></li>
    <li><a href="#SchemaDesign-UseCases">Use Cases</a></li>
    <li><a href="#SchemaDesign-IndexSelection">Index Selection</a></li>
    <li><a href="#SchemaDesign-HowManyCollections%3F">How Many Collections?</a></li>
    <li><a href="#SchemaDesign-SeeAlso">See Also</a></li>
</ul></div>
<h3><a name="SchemaDesign-Introduction"></a>Introduction</h3>

<p>With Mongo, you do less "normalization" than you would perform designing a relational schema because there are no server-side "joins". Generally, you will want one database collection for each of your top level objects.</p>

<p>You do not want a collection for every "class" - instead, embed objects.  For example, in the diagram below, we have two collections, students and courses.  The student documents embed address documents and the "score" documents, which have references to the courses.</p>

<p><span class="image-wrap" style=""><img src="reference.jpg" border="0"></span></p>

<p>Compare this with a relational schema, where you would almost certainly put the scores in a separate table, and have a foreign-key relationship back to the students.</p>

<h3><a name="SchemaDesign-Embedvs.Reference"></a>Embed vs. Reference</h3>

<p>The key question in Mongo schema design is "does this object merit its own collection, or rather should it embed in objects in other collections?"  In relational databases, each sub-item of interest typically becomes a separate table (unless denormalizing for performance).  In Mongo, this is not recommended - embedding objects is much more efficient.  Data is then colocated on disk; client-server turnarounds to the database are eliminated.  So in general the question to ask is, "why would I not want to embed this object?"</p>

<p>So why are references slow?  Let's consider our students example.  If we have a student object and perform:</p>

<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<pre class="code-java">print( student.address.city );
</pre>
</div></div>
<p>This operation will always be fast as address is an embedded object, and is always in RAM if student is in RAM.  However for</p>
<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<pre class="code-java">print( student.scores[0].for_course.name );
</pre>
</div></div>
<p>if this is the first access to <tt>scores[0]</tt>, the shell or your driver must execute the query</p>

<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<pre class="code-java"><span class="code-comment">// pseudocode <span class="code-keyword">for</span> driver or framework, not user code
</span>
student.scores[0].for_course = db.courses.findOne({_id:_course_id_to_find_});
</pre>
</div></div>
<p>Thus, each reference traversal is a query to the database.  Typically, the collection in question is indexed on <tt>_id</tt>.  The query will then be reasonably fast.  However, even if all data is in RAM, there is a certain latency given the client/server communication from appserver to database.  In general, expect 1ms of time for such a query on a ram cache hit.  Thus if we were iterating 1,000 students, looking up one reference per student would be quite slow - over 1 second to perform even if cached.  However, if we only need to look up a single item, the time is on the order of 1ms, and completely acceptable for a web page load.  (Note that if already in db cache, pulling the 1,000 students might actually take much less than 1 second, as the results return from the database in large batches.)</p>

<p>Some general rules on when to embed, and when to reference:</p>
<ul>
	<li>"First class" objects, that are at top level, typically have their own collection.</li>
	<li>Line item detail objects typically are embedded.</li>
	<li>Objects which follow an object modelling "contains" relationship should generally be embedded.</li>
	<li>Many to many relationships are generally by reference.</li>
	<li>Collections with only a few objects may safely exist as separate collections, as the whole collection is quickly cached in application server memory.</li>
	<li>Embedded objects are harder to reference than "top level" objects in collections, as you cannot have a DBRef to an embedded object (at least not yet).</li>
	<li>It is more difficult to get a system-level view for embedded objects.  For example, it would be easier to query the top 100 scores across all students if Scores were not embedded.</li>
	<li>If the amount of data to embed is huge (many megabytes), you may reach the limit on size of a single object.</li>
	<li>If performance is an issue, embed.</li>
</ul>


<h3><a name="SchemaDesign-UseCases"></a>Use Cases</h3>

<p>Let's consider a few use cases now.</p>

<ol>
	<li>Customer / Order / Order Line-Item</li>
</ol>


<ul>
	<li><tt>orders</tt> should be a collection. <tt>customers</tt> a collection.  line-items should be an array of line-items embedded in the <tt>order</tt> object.</li>
</ul>


<ol>
	<li>Blogging system.</li>
</ol>


<ul>
	<li><tt>posts</tt> should be a collection. <tt>post author</tt> might be a separate collection, or simply a field within posts if only an email address. <tt>comments</tt> should be embedded objects within a post for performance.</li>
</ul>


<h3><a name="SchemaDesign-IndexSelection"></a>Index Selection</h3>

<p>A second aspect of schema design is index selection.  As a general rule, <em>where you want an index in a relational database, you want an index in Mongo.</em></p>

<ul>
	<li><tt>The _id</tt> field is automatically indexed.</li>
	<li>Fields upon which keys are looked up should be indexed.</li>
	<li>Sort fields generally should be indexed.</li>
</ul>


<p>The MongoDB profiling facility provides useful information for where an index should be added that is missing.</p>

<p>Note that adding an index slows writes to a collection, but not reads.  Use lots of indexes for collections with a high read : write ratio (assuming one does not mind the storage overage).  For collections with more writes than reads, indexes are very expensive.</p>

<h3><a name="SchemaDesign-HowManyCollections?"></a>How Many Collections?</h3>

<p>As Mongo collections are polymorphic, one could have a collection <tt>objects</tt> and put everything in it!  This approach is taken by some object databases.  For performance reasons, we do not recommend this approach.  Data within a Mongo collection tends to be contiguous on disk.  Thus, table scans of the collection are possible, and efficient.  Collections are very important for high throughput batch processing.</p>

<h3><a name="SchemaDesign-SeeAlso"></a>See Also</h3>

<ul>
	<li><a href="http://www.blip.tv/file/3704083">Schema Design talk from MongoNY</a></li>
	<li><a indepth="true" href="database+references.html" title="Database References">DBRef</a></li>
	<li><a indepth="true" href="trees+in+mongodb.html" title="Trees in MongoDB">Trees in MongoDB</a></li>
	<li><a href="http://www.mongodb.org/display/DOCS/MongoDB+Data+Modeling+and+Rails" title="MongoDB Data Modeling and Rails">MongoDB Data Modeling and Rails</a><br>
<em>Next:</em> <em><a indepth="true" href="advanced+queries.html" title="Advanced Queries">Advanced Queries</a></em></li>
</ul>
</div>
</td>
<td class="noprint" align="left" valign="top" width="22%">
<div class="spacetree">
                                            
    

<div class="plugin_pagetree">

        
        
    <ul class="plugin_pagetree_children_list plugin_pagetree_children_list_noleftspace">
        <div class="plugin_pagetree_children">
        </div>
    </ul>

    <fieldset class="hidden">
        <input name="treeId" value="" type="hidden">
        <input name="treeRequestId" value="/plugins/pagetree/naturalchildren.action?decorator=none&amp;excerpt=false&amp;sort=position&amp;reverse=false&amp;disableLinks=false" type="hidden">
        <input name="treePageId" value="131465" type="hidden">

        <input name="noRoot" value="false" type="hidden">
        <input name="rootPageId" value="131081" type="hidden">

        <input name="rootPage" value="" type="hidden">
        <input name="startDepth" value="0" type="hidden">
        <input name="spaceKey" value="DOCS" type="hidden">

        <input name="i18n-pagetree.loading" value="Loading..." type="hidden">
        <input name="loginUrl" value="/login.action?os_destination=%2Fdisplay%2FDOCS%2FSchema%2BDesign" type="hidden">

                <fieldset class="hidden">
                                                <input name="ancestorId" value="1475663" type="hidden">
                                    <input name="ancestorId" value="1475637" type="hidden">
                                    <input name="ancestorId" value="1048712" type="hidden">
                                    <input name="ancestorId" value="131081" type="hidden">
                                    </fieldset>
    </fieldset>
</div>




<p>
</p>
                        <!-- Schema Design -->
</div>
</td>
</tr>
</tbody></table>
       
       <hr class="grey">
       
       <div class="page-metadata">
    <ul>
                        <li>
    
    <a id="content-metadata-attachments" href="http://www.mongodb.org/pages/viewpageattachments.action?pageId=131465&amp;metadataLink=true" class="page-metadata-icon action-view-attachments" accesskey="a" title="Attachments: 1">
                   <span><span class="page-metadata-attachments-text">Attachments:</span><span class="page-metadata-attachments-count">1</span></span>            </a>
</li>
                <li class="page-metadata-modification-info">
                    Added by <a class="username:rian url fn" href="http://www.mongodb.org/display/%7Erian">Rian Murphy</a>, last edited by <a class="username:kyle url fn" href="http://www.mongodb.org/display/%7Ekyle">Kyle Banker</a> on Jul 19, 2010
                                        <span class="noprint">&nbsp;(<a href="http://www.mongodb.org/pages/diffpages.action?pageId=131465&amp;originalId=16646819">view change</a>)</span>
                            </li>
            </ul>
      <div id="versionComment" class="noteMacro" style="padding: 5px; display: none;">
      <strong>Comment:</strong>
      <br>
  </div>

    
</div>                          
                           
       <!--
<rdf:RDF xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#"
         xmlns:dc="http://purl.org/dc/elements/1.1/"
         xmlns:trackback="http://madskills.com/public/xml/rss/module/trackback/">
         <rdf:Description
    rdf:about="http://www.mongodb.org/display/DOCS/Schema+Design"
    dc:identifier="http://www.mongodb.org/display/DOCS/Schema+Design"
    dc:title="Schema Design"
    trackback:ping="http://www.mongodb.org/rpc/trackback/131465"/>
</rdf:RDF>
-->
       
           
    
    
    


<fieldset class="hidden parameters">
    <legend>Labels parameters</legend>
    <input id="editLabel" value="Edit" type="hidden">
    <input id="addLabel" value="Add Labels" type="hidden">
    <input id="domainName" value="http://www.mongodb.org" type="hidden">
    <input id="pageId" value="131465" type="hidden">
    <input id="spaceKey" value="DOCS" type="hidden">
</fieldset>

<div id="labels-section" class="pageSection">
    <div id="default-labels-header" class="section-header">
        <h2 id="labels-section-title" class="section-title  hidden ">Labels</h2>
            </div>

    <div class="labels-editor">
        <div id="labelsList">
                    </div>

        <span class="errorMessage error" id="errorSpan"></span>
        <form method="GET" action="http://www.mongodb.org/display/DOCS/Schema+Design" id="add-labels-form">
            <div id="labelInputSpan" class="labels-input">
                <div id="labelOperationErrorContainer" class="hidden">
                    <span class="error"><span class="errorMessage" id="labelOperationErrorMessage"></span></span>
                </div>

                <div class="caption">Enter labels to add to this page:</div>

                <input autocomplete="off" id="labelsString" name="labelsString" value="" size="40">
                <input class="add-labels" value="Add" type="submit">
                <input class="hide-labels-editor" value="Done" type="submit">
                <div id="waitImageAndStatus">
                    <img class="waiting" alt="Please wait" src="wait.gif">&nbsp;
                    <span id="labelOperationStatus" class="smalltext"></span>
                </div>
                <div class="auto_complete" id="labelsAutocompleteList"></div>
                <div class="labels-tip">
                    <div id="suggestedLabelsSpan"></div>
                    Looking for a label? Just start typing.
                </div>
            </div>
        </form>
    </div>
</div>
       
                  
           

<!--
    Root decorator: this is a layer of abstraction that Confluence doesn't need. It will be removed eventually.
-->




    
        
    
    


<fieldset class="parameters hidden">
    <input id="deleteCommentConfirmMessage" value="Are you sure you want to remove the comment?" type="hidden">
    <input id="collapseTooltip" value="Click to toggle the display of this comment." type="hidden">
</fieldset>





<div id="comments-section" class="pageSection">
    
            <div class="section-header">
            <ul id="comment-top-links" class="global-comment-actions">
                <li id="comments-expand-collapse">
                    <a href="#" id="comments-collapse">Collapse All</a>
                    <span id="collapse-wait" class="hidden">Collapsing…</span>
                    <span id="expand-wait" class="hidden">Expanding…</span>
                    <a href="#" class="hidden" id="comments-expand">Expand All</a>
                </li>
            </ul>
        </div>
            <!-- added by Kristina 1/7/10 -->
<p>
<b><a style="color: rgb(55, 95, 160);" href="http://groups.google.com/group/mongodb-user">PLEASE POST QUESTIONS IN  THE USER GROUPS FORUM</a>.</b> 
Post non-question comments and helpful hints here.
</p>
            <!-- end -->
<div id="disqus_thread"></div><a href="http://disqus.com/" class="dsq-brlink">blog comments powered by <span class="logo-disqus">Disqus</span></a>
    
    
    
                </div>




       
                                    
       </div>
    <br class="clear">
  </div>
</div>

<div class="sponsor">Copyright © <a class="smalltext" href="http://www.10gen.com/">10gen</a>, Inc. All Rights Reserved | Licensed under <a href="http://creativecommons.org/licenses/by-nc-sa/3.0/">Creative Commons</a></div>







<div id="footer">
                    <ul id="poweredby">
        <li class="noprint">Powered by <a href="http://www.atlassian.com/software/confluence" class="smalltext">Atlassian Confluence</a> 3.0.0_01, the <a href="http://www.atlassian.com/software/confluence" class="smalltext">Enterprise Wiki</a>.</li>
        <li class="print-only">Printed by Atlassian Confluence 3.0.0_01, the Enterprise Wiki.</li>
        <li class="noprint"><a href="http://jira.atlassian.com/secure/BrowseProject.jspa?id=10470" class="smalltext">Bug/feature request</a> –</li>
        <li class="noprint"><a href="http://www.atlassian.com/about/connected.jsp?s_kwcid=Confluence-stayintouch" class="smalltext">Atlassian news</a> –</li>
        <li class="noprint"><a href="http://www.mongodb.org/administrators.action">Contact administrators</a></li>
    </ul>
</div>


</body></html>
