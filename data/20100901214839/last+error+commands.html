<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>


<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">



            <title>Last Error Commands - MongoDB</title>
    
        
        
        
        
        

                        
    
    
            
<meta id="confluence-context-path" name="confluence-context-path" content="">
<meta id="atlassian-token" name="atlassian-token" content="yhfQmnp0a3">
<meta id="confluence-space-key" name="confluence-space-key" content="DOCS">



    

<!-- include system resources -->

<!--[if IE]>
<link type="text/css" rel="stylesheet" href="/s/1627/3/1.0/_/download/batch/confluence.web.resources:master-styles/confluence.web.resources:master-styles.css?ieonly=true" media="all"/>
<![endif]-->





<!--[if IE]>
<link type="text/css" rel="stylesheet" href="/s/1627/3/1.0/_/download/batch/confluence.macros.profile:profile-macro-styles/confluence.macros.profile:profile-macro-styles.css?ieonly=true" media="all"/>
<![endif]-->



















<!--[if IE]>
<link type="text/css" rel="stylesheet" href="/s/1627/3/1.0/_/download/batch/confluence.web.resources:comments/confluence.web.resources:comments.css?ieonly=true" media="all"/>
<![endif]-->







<!--[if IE]>
<link type="text/css" rel="stylesheet" href="/s/1627/3/1.0.2/_/download/batch/com.atlassian.auiplugin:dialog/com.atlassian.auiplugin:dialog.css?ieonly=true" media="all"/>
<![endif]-->






<!--[if IE]>
<link type="text/css" rel="stylesheet" href="/s/1627/3/1.0/_/download/batch/confluence.web.resources:userlink/confluence.web.resources:userlink.css?ieonly=true" media="all"/>
<![endif]-->




<!-- end system resources -->

    

    <meta name="confluence-request-time" content="1283349117317">

    <link rel="shortcut icon" href="favicon.ico">
    <link rel="icon" type="image/png" href="confluence_16.png">

<link rel="search" type="application/opensearchdescription+xml" href="http://www.mongodb.org/opensearch/osd.action" title="10gen Confluence">

    
        
        
    
    <link rel="shortcut icon" href="favicon_001.ico">  

<link rel="stylesheet" type="text/css" href="last+error+commands.css" media="all">
</head><body id="com-atlassian-confluence">
    


    

        
  
    


  <div id="top-right">
    <div class="user-right">
    <ul id="header-menu-bar" class="ajs-menu-bar">
                    
        
            <li class="normal ajs-menu-item">
        <a id="browse-menu-link" class="browse trigger ajs-menu-title" href="#"><span><span>Browse</span></span></a>         <div class="hidden ajs-drop-down">
                        <ul id="browse-menu-link-leading" class="section-leading first">
                                        <li>
    
    <a id="space-pages-link" href="http://www.mongodb.org/pages/listpages.action?key=DOCS" class="">
                   <span>Pages</span>            </a>
</li>
                                        <li>
    
    <a id="space-blogposts-link" href="http://www.mongodb.org/pages/viewrecentblogposts.action?key=DOCS" class="">
                   <span>News</span>            </a>
</li>
                                        <li>
    
    <a id="space-labels-link" href="http://www.mongodb.org/labels/listlabels-heatmap.action?key=DOCS" class="">
                   <span>Labels</span>            </a>
</li>
                                        <li>
    
    <a id="space-attachments-link" href="http://www.mongodb.org/spaces/listattachmentsforspace.action?key=DOCS" class="">
                   <span>Attachments</span>            </a>
</li>
                                        <li>
    
    <a href="http://www.mongodb.org/spaces/space-bookmarks.action?spaceKey=DOCS" class="">
                   <span>Bookmarks</span>            </a>
</li>
                                        <li>
    
    <a id="space-mail-link" href="http://www.mongodb.org/spaces/viewmailarchive.action?key=DOCS" class="">
                   <span>Mail</span>            </a>
</li>
                                        <li>
    
    <a id="space-advanced-link" href="http://www.mongodb.org/spaces/viewspacesummary.action?key=DOCS" class="">
                   <span>Advanced</span>            </a>
</li>
                            </ul>
                    </div>
    </li>
        
                                                         <li class="ajs-menu-item normal">
    
    <a id="login-link" href="http://www.mongodb.org/login.action?os_destination=%2Fdisplay%2FDOCS%2FLast%2BError%2BCommands" class="user-item login-link">
                   <span>Log In</span>            </a>
</li>
                            </ul>
    </div>
  </div>
  

      <div class="search-db">
      <form id="quick-search" class="quick-search" method="get" action="http://www.mongodb.org/dosearchsite.action">
                <fieldset>
            <legend>Quick Search</legend>
            <input value="" class="quick-search-query" id="quick-search-query" accesskey="q" autocomplete="off" name="queryString" size="25" type="text">
            <input class="quick-search-submit" id="quick-search-submit" value="Search" type="submit">
        </fieldset>
        <fieldset class="hidden parameters">
            <input class="quickSearchPlaceholder" id="quickSearchPlaceholder" value="Search" type="hidden">

            <input id="quickNavEnabled" value="true" type="hidden">
             <!-- Quick nav disabled. SettingsManager could not be found -->         </fieldset>
    </form>
      </div>  


  <div id="header-db" class="spread">
    <div class="split">
    	<div id="logo">
    		<div><a href="http://www.mongodb.org/"><img src="logo-mongodb.png" alt="mongoDB" height="90" width="217"></a></div>
    	</div>
    	<div id="nav">
    	</div>
    </div>
  </div>

  <div id="breadcrumbsback" class="spread">
    <div class="split">

    
    <ol id="breadcrumbs">
                                                
            <li><span>
                                                    <a href="http://www.mongodb.org/display/DOCS">MongoDB</a>
                        </span></li>
                                                                    <li id="ellipsis" title="    …
                    Home
                    Developer Zone
        …"><span><strong>…</strong></span></li>
                                                
            <li class="hidden-crumb"><span>
                                                    <a indepth="true" href="home.html">Home</a>
                        </span></li>
                                                            
            <li class="hidden-crumb"><span>
                                                    <a indepth="true" href="index.html">Developer Zone</a>
                        </span></li>
                                            
            <li><span>
                                                    <a indepth="true" href="manual.html">Manual</a>
                        </span></li>
                                            
            <li><span>
                                                    <a indepth="true" href="databases.html">Databases</a>
                        </span></li>
                                            
            <li><span>
                                                    <a indepth="true" href="commands.html">Commands</a>
                        </span></li>
                                            
            <li><span>
                                                    Last Error Commands
                        </span></li>
                </ol>
 
    </div>
  </div>

  <div id="main-db" class="spread">
    <div class="split">
    
                <ul id="user-control-panel">
                                
            <li class="first"><a href="http://www.mongodb.org/login.action?os_destination=%2Fdisplay%2FDOCS%2FLast%2BError%2BCommands">Log In</a></li>

                                                        </ul>
        <div>
    
    <div id="navigation" class="content-navigation view">
        <fieldset class="hidden parameters">
            <input id="pageId" value="3048088" type="hidden">
        </fieldset>
        <ul class="ajs-menu-bar">
                                
            <li class="normal ajs-menu-item">
        <a id="add-menu-link" class="add trigger ajs-menu-title" href="#"><span><span>Add</span></span></a>         <div class="hidden ajs-drop-down">
                        <ul id="add-menu-link-page" class="section-page first">
                                        <li>
    
    <a id="add-comment-menu-link" href="http://www.mongodb.org/display/DOCS/Last+Error+Commands?showComments=true&amp;showCommentArea=true#addcomment" class="add-comment">
                   <span>Comment</span>            </a>
</li>
                            </ul>
                    </div>
    </li>
                    
            <li class="normal ajs-menu-item">
        <a id="action-menu-link" class="action trigger ajs-menu-title" href="#"><span><span>Tools</span></span></a>         <div class="hidden ajs-drop-down">
                        <ul id="action-menu-link-primary" class="section-primary first">
                                        <li>
    
    <a id="view-attachments-link" href="http://www.mongodb.org/pages/viewpageattachments.action?pageId=3048088" class="action-view-attachments" accesskey="a">
                   <span><u>A</u>ttachments (0)</span>            </a>
</li>
                                        <li>
    
    <a id="action-view-history-link" href="http://www.mongodb.org/pages/viewpreviousversions.action?pageId=3048088" class="action-view-history">
                   <span>Page History</span>            </a>
</li>
                            </ul>
                        <ul id="action-menu-link-secondary" class="section-secondary">
                                        <li>
    
    <a id="view-page-info-link" href="http://www.mongodb.org/pages/viewinfo.action?pageId=3048088" class="action-view-info" accesskey="i">
                   <span><u>I</u>nfo</span>            </a>
</li>
                                        <li>
    
    <a id="action-view-source-link" href="http://www.mongodb.org/pages/viewpagesrc.action?pageId=3048088" class="action-view-source popup-link">
                   <span>View Wiki Markup</span>            </a>
</li>
                                        <li>
    
    <a href="http://www.mongodb.org/spaces/flyingpdf/pdfpageexport.action?pageId=3048088&amp;atl_token=yhfQmnp0a3" class="">
                   <span>Export to PDF</span>            </a>
</li>
                                        <li>
    
    <a id="action-export-word-link" href="http://www.mongodb.org/exportword?pageId=3048088" class="action-export-word">
                   <span>Export to Word</span>            </a>
</li>
                            </ul>
                    </div>
    </li>
            </ul>
    </div>

    </div>
    <h1 id="title-heading" class="pagetitle">
                            
		<span id="title-text">
					            <a indepth="true" href="last+error+commands.html">Last Error Commands</a>
    				</span>
    </h1>

    <!--
    Root decorator: this is a layer of abstraction that Confluence doesn't need. It will be removed eventually.
-->




    
    

    
    
        
    
    
                    
    



        
<div id="content" class="page view">
            
        
                        
                                
    
        
                    
        
                

 
<table cellpadding="5" cellspacing="2">
<tbody><tr>
<td class="pagecontent" align="left" valign="top" width="78%">
<div class="wiki-content">
<!-- wiki content -->
            <p>Since MongoDB doesn't wait for a response by default when writing to the database, a couple commands exist for ensuring that these operations have succeeded. These commands can be invoked automatically with many of the drivers when saving and updating in "safe" mode. But what's really happening is that a special command called <tt>getlasterror</tt> is being invoked. Here, we explain how this works.</p>

<div>
<ul>
    <li><a href="#LastErrorCommands-getlasterror">getlasterror</a></li>
<ul>
    <li><a href="#LastErrorCommands-Drivers">Drivers</a></li>
    <li><a href="#LastErrorCommands-UseCases">Use Cases</a></li>
    <li><a href="#LastErrorCommands-MongoShellDOCS%3AmongoTheInteractiveShellBehavior"> Mongo Shell Behavior</a></li>
    <li><a href="#LastErrorCommands-fsyncoption">fsync option</a></li>
    <li><a href="#LastErrorCommands-WithReplication">With Replication</a></li>
</ul>
    <li><a href="#LastErrorCommands-getPrevError">getPrevError</a></li>
</ul></div>
<h2><a name="LastErrorCommands-getlasterror"></a>getlasterror</h2>

<p>The <tt>getlasterror</tt> command checks for an error on the last database operation for this connection. Since it's a command, there are a few ways to invoke it:</p>
<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<pre class="code-java">&gt; db.$cmd.findOne({getlasterror:1})</pre>
</div></div>
<p>Or</p>
<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<pre class="code-java">&gt; db.runCommand(<span class="code-quote">"getlasterror"</span>)</pre>
</div></div>
<p>Or you can use the helper:</p>
<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<pre class="code-java">&gt; db.getLastError()</pre>
</div></div>
<p>For more about commands, see the <a indepth="true" href="commands.html" title="Commands">command documentation</a>.</p>

<h3><a name="LastErrorCommands-Drivers"></a>Drivers</h3>

<p>The drivers support <tt>getlasterror</tt> in the command form and many also offer a "safe" mode for operations. If you're using Python, for example, you automatically call getlasterror on insert as follows:</p>
<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<pre class="code-java">collection.save({<span class="code-quote">"name"</span>: <span class="code-quote">"MongoDB"</span>}, safe=True)
</pre>
</div></div>
<p>If the save doesn't succeed, an exception will be raised. For more on "safe" mode, see your driver's documentation.<br>
<iframe id="docframe-getlasterror" src="last+error+commands_1.html" margin="0" padding="0" scrolling="no" frameborder="0" height="17" width="500"></iframe><a name="getlasterror" margin="0" padding="0"></a>
</p>
<h3><a name="LastErrorCommands-UseCases"></a>Use Cases</h3>

<p>getlasterror is primarily useful for write operations (although it is set after a command or query too).&nbsp; Write operations by default do not have a return code: this saves the client from waiting for client/server turnarounds during write operations.&nbsp; One can always call getLastError if one wants a return code.</p>

<p>If you're writing data to MongoDB on multiple connections, then it can sometimes be important to call <tt>getlasterror</tt> on one connection to be certain that the data has been committed to the database. For instance, if you're writing to connection #1 and want those writes to be reflected in reads from connection #2, you can assure this by calling <tt>getlasterror</tt> after writing to connection #1.</p>

<p>Note: The special <a href="http://www.mongodb.org/display/DOCS/Mongo+Wire+Protocol" title="Mongo Wire Protocol">mongo wire protocol</a> killCursors operation does not support getlasterror.&nbsp; (This is really only of significant to <a href="http://www.mongodb.org/display/DOCS/Overview+-+Writing+Drivers+and+Tools" title="Overview - Writing Drivers and Tools">driver developers</a> .)</p>


<h3><a name="LastErrorCommands-MongoShellDOCS:mongoTheInteractiveShellBehavior"></a><a indepth="true" href="mongo+-+the+interactive+shell.html" title="mongo - The Interactive Shell">Mongo Shell</a> Behavior</h3>


<p>The database shell performs a <tt>resetError()</tt> before each read/eval/print loop command evaluation - and automatically prints the error, if one occurred, after each evaluation.  Thus, after an error, at the shell prompt <tt>db.getLastError()</tt> will return null.  However, if called before returning to the prompt, the result is as one would expect:</p>

<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<pre class="code-java">&gt; <span class="code-keyword">try</span> { db.foo.findOne() } <span class="code-keyword">catch</span>(e) { print(<span class="code-quote">"preverr:"</span> + tojson(db.getPrevError())); print(<span class="code-quote">"lasterr:"</span> + tojson(db.getLastError()));}
preverr:{<span class="code-quote">"err"</span> : <span class="code-quote">"unauthorized"</span> , <span class="code-quote">"nPrev"</span> : 1 , <span class="code-quote">"ok"</span> : 1}
lasterr:<span class="code-quote">"unauthorized"</span></pre>
</div></div>
<h3><a name="LastErrorCommands-fsyncoption"></a>fsync option</h3>

<p>Include the fsync option to force the database to fsync all files before returning (v1.3+):</p>
<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<pre class="code-java">&gt; db.runCommand({getlasterror:1,fsync:<span class="code-keyword">true</span>})
{ <span class="code-quote">"err"</span> : <span class="code-keyword">null</span>, <span class="code-quote">"n"</span> : 0, <span class="code-quote">"fsyncFiles"</span> : 2, <span class="code-quote">"ok"</span> : 1 }
</pre>
</div></div>
<h3><a name="LastErrorCommands-WithReplication"></a>With Replication</h3>

<p>See <a href="http://www.mongodb.org/display/DOCS/Replication#Replication-ReplicationAcknowledgementviagetlasterror">blocking for replication</a>.</p>

<h2><a name="LastErrorCommands-getPrevError"></a>getPrevError</h2>

<p><em>Note: getPrevError may be deprecated in the future.</em></p>

<p>When performing bulk write operations, <tt>resetError()</tt> and <tt>getPrevError()</tt> can be an efficient way to check for success of the operation.&nbsp; For example if we are inserting 1,000 objects in a collection, checking the return code 1,000 times over the network is slow.&nbsp; Instead one might do something like this:</p>

<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<pre class="code-java">db.resetError();&nbsp;
<span class="code-keyword">for</span>( loop 1000 times... )
 &nbsp;&nbsp; db.foo.save(something...);
<span class="code-keyword">if</span>( db.getPrevError().err )&nbsp;
    print(<span class="code-quote">"didn't work!"</span>);</pre>
</div></div>
</div>
</td>
<td class="noprint" align="left" valign="top" width="22%">
<div class="spacetree">
                                            
    

<div class="plugin_pagetree">

        
        
    <ul class="plugin_pagetree_children_list plugin_pagetree_children_list_noleftspace">
        <div class="plugin_pagetree_children">
        </div>
    </ul>

    <fieldset class="hidden">
        <input name="treeId" value="" type="hidden">
        <input name="treeRequestId" value="/plugins/pagetree/naturalchildren.action?decorator=none&amp;excerpt=false&amp;sort=position&amp;reverse=false&amp;disableLinks=false" type="hidden">
        <input name="treePageId" value="3048088" type="hidden">

        <input name="noRoot" value="false" type="hidden">
        <input name="rootPageId" value="131081" type="hidden">

        <input name="rootPage" value="" type="hidden">
        <input name="startDepth" value="0" type="hidden">
        <input name="spaceKey" value="DOCS" type="hidden">

        <input name="i18n-pagetree.loading" value="Loading..." type="hidden">
        <input name="loginUrl" value="/login.action?os_destination=%2Fdisplay%2FDOCS%2FLast%2BError%2BCommands" type="hidden">

                <fieldset class="hidden">
                                                <input name="ancestorId" value="131174" type="hidden">
                                    <input name="ancestorId" value="1475643" type="hidden">
                                    <input name="ancestorId" value="1475637" type="hidden">
                                    <input name="ancestorId" value="1048712" type="hidden">
                                    <input name="ancestorId" value="131081" type="hidden">
                                    </fieldset>
    </fieldset>
</div>




<p>
</p>
                        <!-- Last Error Commands -->
</div>
</td>
</tr>
</tbody></table>
       
       <hr class="grey">
       
       <div class="page-metadata">
    <ul>
                <li class="page-metadata-modification-info">
                    Added by <a class="username:dwight url fn" href="http://www.mongodb.org/display/%7Edwight">Dwight Merriman</a>, last edited by <a class="username:mathias url fn" href="http://www.mongodb.org/display/%7Emathias">Mathias Stearn</a> on Apr 29, 2010
                                        <span class="noprint">&nbsp;(<a href="http://www.mongodb.org/pages/diffpages.action?pageId=3048088&amp;originalId=12157005">view change</a>)</span>
                            </li>
                <li class="show-hide-comment-link">
            <a id="show" class="inline-control-link" href="#" onclick="showComment(); return false;">show comment</a>
            <a id="hide" class="inline-control-link" style="display: none;" href="#" onclick="hideComment(); return false;">hide comment</a>
        </li>
            </ul>
      <div id="versionComment" class="noteMacro" style="padding: 5px; display: none;">
      <strong>Comment:</strong>
      link fix take 2<br>
  </div>

    
</div>                          
                           
       <!--
<rdf:RDF xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#"
         xmlns:dc="http://purl.org/dc/elements/1.1/"
         xmlns:trackback="http://madskills.com/public/xml/rss/module/trackback/">
         <rdf:Description
    rdf:about="http://www.mongodb.org/display/DOCS/Last+Error+Commands"
    dc:identifier="http://www.mongodb.org/display/DOCS/Last+Error+Commands"
    dc:title="Last Error Commands"
    trackback:ping="http://www.mongodb.org/rpc/trackback/3048088"/>
</rdf:RDF>
-->
       
           
    
    
    


<fieldset class="hidden parameters">
    <legend>Labels parameters</legend>
    <input id="editLabel" value="Edit" type="hidden">
    <input id="addLabel" value="Add Labels" type="hidden">
    <input id="domainName" value="http://www.mongodb.org" type="hidden">
    <input id="pageId" value="3048088" type="hidden">
    <input id="spaceKey" value="DOCS" type="hidden">
</fieldset>

<div id="labels-section" class="pageSection">
    <div id="default-labels-header" class="section-header">
        <h2 id="labels-section-title" class="section-title  hidden ">Labels</h2>
            </div>

    <div class="labels-editor">
        <div id="labelsList">
                    </div>

        <span class="errorMessage error" id="errorSpan"></span>
        <form method="GET" action="http://www.mongodb.org/display/DOCS/Last+Error+Commands" id="add-labels-form">
            <div id="labelInputSpan" class="labels-input">
                <div id="labelOperationErrorContainer" class="hidden">
                    <span class="error"><span class="errorMessage" id="labelOperationErrorMessage"></span></span>
                </div>

                <div class="caption">Enter labels to add to this page:</div>

                <input autocomplete="off" id="labelsString" name="labelsString" value="" size="40">
                <input class="add-labels" value="Add" type="submit">
                <input class="hide-labels-editor" value="Done" type="submit">
                <div id="waitImageAndStatus">
                    <img class="waiting" alt="Please wait" src="wait.gif">&nbsp;
                    <span id="labelOperationStatus" class="smalltext"></span>
                </div>
                <div class="auto_complete" id="labelsAutocompleteList"></div>
                <div class="labels-tip">
                    <div id="suggestedLabelsSpan"></div>
                    Looking for a label? Just start typing.
                </div>
            </div>
        </form>
    </div>
</div>
       
                  
           

<!--
    Root decorator: this is a layer of abstraction that Confluence doesn't need. It will be removed eventually.
-->




    
        
    
    


<fieldset class="parameters hidden">
    <input id="deleteCommentConfirmMessage" value="Are you sure you want to remove the comment?" type="hidden">
    <input id="collapseTooltip" value="Click to toggle the display of this comment." type="hidden">
</fieldset>





<div id="comments-section" class="pageSection">
    
            <div class="section-header">
            <ul id="comment-top-links" class="global-comment-actions">
                <li id="comments-expand-collapse">
                    <a href="#" id="comments-collapse">Collapse All</a>
                    <span id="collapse-wait" class="hidden">Collapsing…</span>
                    <span id="expand-wait" class="hidden">Expanding…</span>
                    <a href="#" class="hidden" id="comments-expand">Expand All</a>
                </li>
            </ul>
        </div>
            <!-- added by Kristina 1/7/10 -->
<p>
<b><a style="color: rgb(55, 95, 160);" href="http://groups.google.com/group/mongodb-user">PLEASE POST QUESTIONS IN  THE USER GROUPS FORUM</a>.</b> 
Post non-question comments and helpful hints here.
</p>
            <!-- end -->
<div id="disqus_thread"></div><a href="http://disqus.com/" class="dsq-brlink">blog comments powered by <span class="logo-disqus">Disqus</span></a>
    
    
    
                </div>




       
                                    
       </div>
    <br class="clear">
  </div>
</div>

<div class="sponsor">Copyright © <a class="smalltext" href="http://www.10gen.com/">10gen</a>, Inc. All Rights Reserved | Licensed under <a href="http://creativecommons.org/licenses/by-nc-sa/3.0/">Creative Commons</a></div>







<div id="footer">
                    <ul id="poweredby">
        <li class="noprint">Powered by <a href="http://www.atlassian.com/software/confluence" class="smalltext">Atlassian Confluence</a> 3.0.0_01, the <a href="http://www.atlassian.com/software/confluence" class="smalltext">Enterprise Wiki</a>.</li>
        <li class="print-only">Printed by Atlassian Confluence 3.0.0_01, the Enterprise Wiki.</li>
        <li class="noprint"><a href="http://jira.atlassian.com/secure/BrowseProject.jspa?id=10470" class="smalltext">Bug/feature request</a> –</li>
        <li class="noprint"><a href="http://www.atlassian.com/about/connected.jsp?s_kwcid=Confluence-stayintouch" class="smalltext">Atlassian news</a> –</li>
        <li class="noprint"><a href="http://www.mongodb.org/administrators.action">Contact administrators</a></li>
    </ul>
</div>


</body></html>
