<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>


<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">



            <title>Updating - MongoDB</title>
    
        
        
        
        
        

                        
    
    
            
<meta id="confluence-context-path" name="confluence-context-path" content="">
<meta id="atlassian-token" name="atlassian-token" content="yhfQmnp0a3">
<meta id="confluence-space-key" name="confluence-space-key" content="DOCS">



    

<!-- include system resources -->

<!--[if IE]>
<link type="text/css" rel="stylesheet" href="/s/1627/3/1.0/_/download/batch/confluence.web.resources:master-styles/confluence.web.resources:master-styles.css?ieonly=true" media="all"/>
<![endif]-->





<!--[if IE]>
<link type="text/css" rel="stylesheet" href="/s/1627/3/1.0/_/download/batch/confluence.macros.profile:profile-macro-styles/confluence.macros.profile:profile-macro-styles.css?ieonly=true" media="all"/>
<![endif]-->



















<!--[if IE]>
<link type="text/css" rel="stylesheet" href="/s/1627/3/1.0/_/download/batch/confluence.web.resources:comments/confluence.web.resources:comments.css?ieonly=true" media="all"/>
<![endif]-->







<!--[if IE]>
<link type="text/css" rel="stylesheet" href="/s/1627/3/1.0.2/_/download/batch/com.atlassian.auiplugin:dialog/com.atlassian.auiplugin:dialog.css?ieonly=true" media="all"/>
<![endif]-->






<!--[if IE]>
<link type="text/css" rel="stylesheet" href="/s/1627/3/1.0/_/download/batch/confluence.web.resources:userlink/confluence.web.resources:userlink.css?ieonly=true" media="all"/>
<![endif]-->




<!-- end system resources -->

    

    <meta name="confluence-request-time" content="1283349011180">

    <link rel="shortcut icon" href="favicon.ico">
    <link rel="icon" type="image/png" href="confluence_16.png">

<link rel="search" type="application/opensearchdescription+xml" href="http://www.mongodb.org/opensearch/osd.action" title="10gen Confluence">

    
        
        
    
    <link rel="shortcut icon" href="favicon_001.ico">  

<link rel="stylesheet" type="text/css" href="updating.css" media="all">
</head><body id="com-atlassian-confluence">
    


    

        
  
    


  <div id="top-right">
    <div class="user-right">
    <ul id="header-menu-bar" class="ajs-menu-bar">
                    
        
            <li class="normal ajs-menu-item">
        <a id="browse-menu-link" class="browse trigger ajs-menu-title" href="#"><span><span>Browse</span></span></a>         <div class="hidden ajs-drop-down">
                        <ul id="browse-menu-link-leading" class="section-leading first">
                                        <li>
    
    <a id="space-pages-link" href="http://www.mongodb.org/pages/listpages.action?key=DOCS" class="">
                   <span>Pages</span>            </a>
</li>
                                        <li>
    
    <a id="space-blogposts-link" href="http://www.mongodb.org/pages/viewrecentblogposts.action?key=DOCS" class="">
                   <span>News</span>            </a>
</li>
                                        <li>
    
    <a id="space-labels-link" href="http://www.mongodb.org/labels/listlabels-heatmap.action?key=DOCS" class="">
                   <span>Labels</span>            </a>
</li>
                                        <li>
    
    <a id="space-attachments-link" href="http://www.mongodb.org/spaces/listattachmentsforspace.action?key=DOCS" class="">
                   <span>Attachments</span>            </a>
</li>
                                        <li>
    
    <a href="http://www.mongodb.org/spaces/space-bookmarks.action?spaceKey=DOCS" class="">
                   <span>Bookmarks</span>            </a>
</li>
                                        <li>
    
    <a id="space-mail-link" href="http://www.mongodb.org/spaces/viewmailarchive.action?key=DOCS" class="">
                   <span>Mail</span>            </a>
</li>
                                        <li>
    
    <a id="space-advanced-link" href="http://www.mongodb.org/spaces/viewspacesummary.action?key=DOCS" class="">
                   <span>Advanced</span>            </a>
</li>
                            </ul>
                    </div>
    </li>
        
                                                         <li class="ajs-menu-item normal">
    
    <a id="login-link" href="http://www.mongodb.org/login.action?os_destination=%2Fdisplay%2FDOCS%2FUpdating" class="user-item login-link">
                   <span>Log In</span>            </a>
</li>
                            </ul>
    </div>
  </div>
  

      <div class="search-db">
      <form id="quick-search" class="quick-search" method="get" action="http://www.mongodb.org/dosearchsite.action">
                <fieldset>
            <legend>Quick Search</legend>
            <input value="" class="quick-search-query" id="quick-search-query" accesskey="q" autocomplete="off" name="queryString" size="25" type="text">
            <input class="quick-search-submit" id="quick-search-submit" value="Search" type="submit">
        </fieldset>
        <fieldset class="hidden parameters">
            <input class="quickSearchPlaceholder" id="quickSearchPlaceholder" value="Search" type="hidden">

            <input id="quickNavEnabled" value="true" type="hidden">
             <!-- Quick nav disabled. SettingsManager could not be found -->         </fieldset>
    </form>
      </div>  


  <div id="header-db" class="spread">
    <div class="split">
    	<div id="logo">
    		<div><a href="http://www.mongodb.org/"><img src="logo-mongodb.png" alt="mongoDB" height="90" width="217"></a></div>
    	</div>
    	<div id="nav">
    	</div>
    </div>
  </div>

  <div id="breadcrumbsback" class="spread">
    <div class="split">

    
    <ol id="breadcrumbs">
                                                
            <li><span>
                                                    <a href="http://www.mongodb.org/display/DOCS">MongoDB</a>
                        </span></li>
                                            
            <li><span>
                                                    <a indepth="true" href="home.html">Home</a>
                        </span></li>
                                            
            <li><span>
                                                    <a indepth="true" href="index.html">Developer Zone</a>
                        </span></li>
                                            
            <li><span>
                                                    <a indepth="true" href="manual.html">Manual</a>
                        </span></li>
                                            
            <li><span>
                                                    Updating
                        </span></li>
                </ol>
 
    </div>
  </div>

  <div id="main-db" class="spread">
    <div class="split">
    
                <ul id="user-control-panel">
                                
            <li class="first"><a href="http://www.mongodb.org/login.action?os_destination=%2Fdisplay%2FDOCS%2FUpdating">Log In</a></li>

                                                        </ul>
        <div>
    
    <div id="navigation" class="content-navigation view">
        <fieldset class="hidden parameters">
            <input id="pageId" value="1475679" type="hidden">
        </fieldset>
        <ul class="ajs-menu-bar">
                                
            <li class="normal ajs-menu-item">
        <a id="add-menu-link" class="add trigger ajs-menu-title" href="#"><span><span>Add</span></span></a>         <div class="hidden ajs-drop-down">
                        <ul id="add-menu-link-page" class="section-page first">
                                        <li>
    
    <a id="add-comment-menu-link" href="http://www.mongodb.org/display/DOCS/Updating?showComments=true&amp;showCommentArea=true#addcomment" class="add-comment">
                   <span>Comment</span>            </a>
</li>
                            </ul>
                    </div>
    </li>
                    
            <li class="normal ajs-menu-item">
        <a id="action-menu-link" class="action trigger ajs-menu-title" href="#"><span><span>Tools</span></span></a>         <div class="hidden ajs-drop-down">
                        <ul id="action-menu-link-primary" class="section-primary first">
                                        <li>
    
    <a id="view-attachments-link" href="http://www.mongodb.org/pages/viewpageattachments.action?pageId=1475679" class="action-view-attachments" accesskey="a">
                   <span><u>A</u>ttachments (0)</span>            </a>
</li>
                                        <li>
    
    <a id="action-view-history-link" href="http://www.mongodb.org/pages/viewpreviousversions.action?pageId=1475679" class="action-view-history">
                   <span>Page History</span>            </a>
</li>
                            </ul>
                        <ul id="action-menu-link-secondary" class="section-secondary">
                                        <li>
    
    <a id="view-page-info-link" href="http://www.mongodb.org/pages/viewinfo.action?pageId=1475679" class="action-view-info" accesskey="i">
                   <span><u>I</u>nfo</span>            </a>
</li>
                                        <li>
    
    <a id="action-view-source-link" href="http://www.mongodb.org/pages/viewpagesrc.action?pageId=1475679" class="action-view-source popup-link">
                   <span>View Wiki Markup</span>            </a>
</li>
                                        <li>
    
    <a href="http://www.mongodb.org/spaces/flyingpdf/pdfpageexport.action?pageId=1475679&amp;atl_token=yhfQmnp0a3" class="">
                   <span>Export to PDF</span>            </a>
</li>
                                        <li>
    
    <a id="action-export-word-link" href="http://www.mongodb.org/exportword?pageId=1475679" class="action-export-word">
                   <span>Export to Word</span>            </a>
</li>
                            </ul>
                    </div>
    </li>
            </ul>
    </div>

    </div>
    <h1 id="title-heading" class="pagetitle">
                            
		<span id="title-text">
					            <a indepth="true" href="updating.html">Updating</a>
    				</span>
    </h1>

    <!--
    Root decorator: this is a layer of abstraction that Confluence doesn't need. It will be removed eventually.
-->




    
    

    
    
        
    
    
                    
    



        
<div id="content" class="page view">
            
        
                        
                                
    
        
                    
        
                

 
<table cellpadding="5" cellspacing="2">
<tbody><tr>
<td class="pagecontent" align="left" valign="top" width="78%">
<div class="wiki-content">
<!-- wiki content -->
            <p>MongoDB supports atomic, in-place updates as well as more traditional updates for replacing an entire document.</p>

<p><iframe id="docframe-update" src="updating_1.html" margin="0" padding="0" scrolling="no" frameborder="0" height="17" width="500"></iframe><a name="update" margin="0" padding="0"></a>
</p>
<div>
<ul>
    <li><a href="#Updating-update%28%29">update()</a></li>
    <li><a href="#Updating-%7B%7Bsave%28%29%7D%7Dinthemongoshell"> <tt>save()</tt> in the mongo shell</a></li>
    <li><a href="#Updating-ModifierOperations">Modifier Operations</a></li>
<ul>
<ul>
    <li><a href="#Updating-%24inc">$inc</a></li>
    <li><a href="#Updating-%24set">$set</a></li>
    <li><a href="#Updating-%24unset">$unset</a></li>
    <li><a href="#Updating-%24push">$push</a></li>
    <li><a href="#Updating-%24pushAll">$pushAll</a></li>
    <li><a href="#Updating-%24addToSet">$addToSet</a></li>
    <li><a href="#Updating-%24pop">$pop</a></li>
    <li><a href="#Updating-%24pull">$pull</a></li>
    <li><a href="#Updating-%24pullAll">$pullAll</a></li>
</ul>
    <li><a href="#Updating-The%24positionaloperator">The $ positional operator</a></li>
    <li><a href="#Updating-UpsertswithModifiers">Upserts with Modifiers</a></li>
    <li><a href="#Updating-PushingaUniqueValue">Pushing a Unique Value</a></li>
</ul>
    <li><a href="#Updating-CheckingtheOutcomeofanUpdateRequest">Checking the Outcome of an Update Request</a></li>
    <li><a href="#Updating-Notes">Notes</a></li>
<ul>
    <li><a href="#Updating-ObjectPadding">Object Padding</a></li>
    <li><a href="#Updating-Blocking">Blocking</a></li>
</ul>
    <li><a href="#Updating-SeeAlso">See Also</a></li>
</ul></div>

<h2><a name="Updating-update()"></a>update()</h2>

<p><tt>update()</tt> replaces the document matching criteria entirely with objNew.  If you only want to modify some fields, you should use the atomic modifiers below.</p>


<p>Here's the MongoDB shell syntax for <tt>update()</tt>:</p>

<p><tt>db.collection.update( <em>criteria</em>, <em>objNew</em>, <em>upsert</em>, <em>multi</em> )</tt></p>

<p>Arguments:</p>
<ul>
	<li><tt><em>criteria</em></tt> - query which selects the record to update;</li>
	<li><tt><em>objNew</em></tt> - updated object or $ operators (e.g., $inc) which manipulate the object</li>
	<li><tt><em>upsert</em></tt> - if this should be an "upsert"; that is, if the record does not exist, insert it</li>
	<li><tt><em>multi</em></tt> - if all documents matching <tt><em>criteria</em></tt> should be updated</li>
</ul>


<div class="panelMacro"><table class="infoMacro"><colgroup><col width="24"><col></colgroup><tbody><tr><td valign="top"><img src="information.gif" alt="" align="absmiddle" border="0" height="16" width="16"></td><td>If you are coming from SQL, be aware that by default, update() only modifies the first matched object. If you want to modify all matched objects you need to use the multi flag</td></tr></tbody></table></div>

<h2><a name="Updating-{{save()}}inthemongoshell"></a><tt>save()</tt> in the mongo shell</h2>

<p>The save() command in the <a indepth="true" href="mongo+-+the+interactive+shell.html" title="mongo - The Interactive Shell">mongo shell</a> provides a shorthand syntax to perform a single object update with upsert:</p>

<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<pre class="code-java"><span class="code-comment">// x is some JSON style object
</span>db.mycollection.save(x); <span class="code-comment">// updates <span class="code-keyword">if</span> exists; inserts <span class="code-keyword">if</span> <span class="code-keyword">new</span></span>
</pre>
</div></div>
<p><tt>save()</tt> does an upsert if <tt>x</tt> has an _id field and an insert if it does not.  Thus, normally, you will not need to explicitly request upserts, just use <tt>save()</tt>.</p>

<p>Upsert means "update if present; insert if missing".</p>

<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<pre class="code-java">myColl.update( { name: <span class="code-quote">"Joe"</span> }, { name: <span class="code-quote">"Joe"</span>, age: 20 }, <span class="code-keyword">true</span> );
</pre>
</div></div>

<h2><a name="Updating-ModifierOperations"></a>Modifier Operations</h2>

<p>Modifier operations are highly-efficient and useful when updating existing values; for instance, they're great for incrementing a number.</p>

<p>So, while a conventional implementation does work:</p>
<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<pre class="code-java"><span class="code-keyword">var</span> j=myColl.findOne( { name: <span class="code-quote">"Joe"</span> } );
j.n++;
myColl.save(j);
</pre>
</div></div>
<p>a modifier update has the advantages of avoiding the latency involved in querying and returning the object. The modifier update also features operation <a indepth="true" href="atomic+operations.html" title="Atomic Operations">atomicity</a> and very little network data transfer.</p>

<p>To perform an atomic update, simply specify any of the special update operators (which always start with a '$' character) with a relevant update document:</p>

<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<pre class="code-java">db.people.update( { name:<span class="code-quote">"Joe"</span> }, { $inc: { n : 1 } } );</pre>
</div></div>
<p>The preceding example says, "Find the first document where 'name' is 'Joe' and then increment 'n' by one."</p>

<div class="panelMacro"><table class="infoMacro"><colgroup><col width="24"><col></colgroup><tbody><tr><td valign="top"><img src="information.gif" alt="" align="absmiddle" border="0" height="16" width="16"></td><td><p>While not shown in the examples, most modifier operators will accept multiple field/value pairs when one wishes to modify multiple fields. For example, the following operation would set x to 1 and y to 2:</p>
<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<pre class="code-java">{ $set : { x : 1 , y : 2 } }</pre>
</div></div>

<p>Also, multiple operators are valid too:</p>

<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<pre class="code-java">{ $set : { x : 1 }, $inc : { y : 1 } }</pre>
</div></div></td></tr></tbody></table></div>

<h4><a name="Updating-$inc"></a>$inc</h4>

<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<pre class="code-java">{ $inc : { field : value } }</pre>
</div></div>
<p>increments <tt><em>field</em></tt> by the number <tt><em>value</em></tt> if <tt><em>field</em></tt> is present in the object, otherwise sets <tt><em>field</em></tt> to the number <tt><em>value</em></tt>.</p>

<h4><a name="Updating-$set"></a>$set</h4>

<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<pre class="code-java">{ $set : { field : value } }</pre>
</div></div>
<p>sets <tt><em>field</em></tt> to <tt><em>value</em></tt>.  All datatypes are supported with <tt>$set</tt>.</p>

<h4><a name="Updating-$unset"></a>$unset</h4>

<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<pre class="code-java">{ $unset : { field : 1} }</pre>
</div></div>
<p>Deletes a given field.  v1.3+</p>

<h4><a name="Updating-$push"></a>$push</h4>

<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<pre class="code-java">{ $push : { field : value } }</pre>
</div></div>
<p>appends <tt><em>value</em></tt> to <tt><em>field</em></tt>, if <tt><em>field</em></tt> is an existing array, otherwise sets <tt><em>field</em></tt> to the array [<tt><em>value</em></tt>] if <tt><em>field</em></tt> is not present.  If <tt><em>field</em></tt> is present but is not an array, an error condition is raised.</p>

<h4><a name="Updating-$pushAll"></a>$pushAll</h4>

<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<pre class="code-java">{ $pushAll : { field : value_array } }</pre>
</div></div>
<p>appends each value in <tt><em>value_array</em></tt> to <tt><em>field</em></tt>, if <tt><em>field</em></tt> is an existing array, otherwise sets <tt><em>field</em></tt> to the array <tt><em>value_array</em></tt> if <tt><em>field</em></tt> is not present.  If <tt><em>field</em></tt> is present but is not an array, an error condition is raised.</p>

<h4><a name="Updating-$addToSet"></a>$addToSet</h4>

<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<pre class="code-java">{ $addToSet : { field : value } }</pre>
</div></div>
<p>Adds value to the array only if its not in the array already.</p>

<p>To add many valuest.update</p>
<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<pre class="code-java">{ $addToSet : { a : { $each : [ 3 , 5 , 6 ] } } }</pre>
</div></div>

<h4><a name="Updating-$pop"></a>$pop</h4>

<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<pre class="code-java">{ $pop : { field : 1  } }</pre>
</div></div>
<p>removes the last element in an array (ADDED in 1.1)</p>

<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<pre class="code-java">{ $pop : { field : -1  } }</pre>
</div></div>
<p>removes the first element in an array (ADDED in 1.1) |</p>

<h4><a name="Updating-$pull"></a>$pull</h4>

<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<pre class="code-java">{ $pull : { field : _value } }</pre>
</div></div>
<p>removes all occurrences of <tt><em>value</em></tt> from <tt><em>field</em></tt>, if <tt><em>field</em></tt> is an array.  If <tt><em>field</em></tt> is present but is not an array, an error condition is raised.</p>

<h4><a name="Updating-$pullAll"></a>$pullAll</h4>

<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<pre class="code-java">{ $pullAll : { field : value_array } }</pre>
</div></div>
<p>removes all occurrences of each value in <tt><em>value_array</em></tt> from <tt><em>field</em></tt>, if <tt><em>field</em></tt> is an array.  If <tt><em>field</em></tt> is present but is not an array, an error condition is raised.</p>

<h3><a name="Updating-The$positionaloperator"></a>The $ positional operator</h3>

<p>Version 1.3.4+ only.</p>

<p>The $ operator (by itself) means "position of the matched array item in the query".  Use this to find an array member and then manipulate it.  For example:</p>

<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<pre class="code-java">&gt; t.find()
{ <span class="code-quote">"_id"</span> : ObjectId(<span class="code-quote">"4b97e62bf1d8c7152c9ccb74"</span>), <span class="code-quote">"title"</span> : <span class="code-quote">"ABC"</span>,
  <span class="code-quote">"comments"</span> : [ { <span class="code-quote">"by"</span> : <span class="code-quote">"joe"</span>, <span class="code-quote">"votes"</span> : 3 }, { <span class="code-quote">"by"</span> : <span class="code-quote">"jane"</span>, <span class="code-quote">"votes"</span> : 7 } ] }

&gt; t.update( {'comments.by':'joe'}, {$inc:{'comments.$.votes':1}}, <span class="code-keyword">false</span>, <span class="code-keyword">true</span> )

&gt; t.find()
{ <span class="code-quote">"_id"</span> : ObjectId(<span class="code-quote">"4b97e62bf1d8c7152c9ccb74"</span>), <span class="code-quote">"title"</span> : <span class="code-quote">"ABC"</span>,
  <span class="code-quote">"comments"</span> : [ { <span class="code-quote">"by"</span> : <span class="code-quote">"joe"</span>, <span class="code-quote">"votes"</span> : 4 }, { <span class="code-quote">"by"</span> : <span class="code-quote">"jane"</span>, <span class="code-quote">"votes"</span> : 7 } ] }
</pre>
</div></div>
<p>Currently the $ operator only applies to the <b>first</b> matched item in the query. For example:</p>

<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<pre class="code-java">&gt; t.find();
{ <span class="code-quote">"_id"</span> : ObjectId(<span class="code-quote">"4b9e4a1fc583fa1c76198319"</span>), <span class="code-quote">"x"</span> : [ 1, 2, 3, 2 ] }
&gt; t.update({x: 2}, {$inc: {<span class="code-quote">"x.$"</span>: 1}}, <span class="code-keyword">false</span>, <span class="code-keyword">true</span>);
&gt; t.find();
{ <span class="code-quote">"_id"</span> : ObjectId(<span class="code-quote">"4b9e4a1fc583fa1c76198319"</span>), <span class="code-quote">"x"</span> : [ 1, 3, 3, 2 ] }
</pre>
</div></div>

<p>The positional operator cannot be combined with an <tt>upsert</tt> since it requires a matching array element. If your update results in an insert then the "$" will literally be used as the field name.</p>

<div class="panelMacro"><table class="infoMacro"><colgroup><col width="24"><col></colgroup><tbody><tr><td valign="top"><img src="information.gif" alt="" align="absmiddle" border="0" height="16" width="16"></td><td><p>Using "$unset" with an expression like this "array.$" will result in the array item becoming <tt>null</tt>, not being removed. You can issue an update with "{$pull:{x:null}}" to remove all nulls.</p>
<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<pre class="code-java">&gt; t.insert({x: [1,2,3,4,3,2,3,4]})
&gt; t.find()
{ <span class="code-quote">"_id"</span> : ObjectId(<span class="code-quote">"4bde2ad3755d00000000710e"</span>), <span class="code-quote">"x"</span> : [ 1, 2, 3, 4, 3, 2, 3, 4 ] }
&gt; t.update({x:3}, {$unset:{<span class="code-quote">"x.$"</span>:1}})
&gt; t.find()
{ <span class="code-quote">"_id"</span> : ObjectId(<span class="code-quote">"4bde2ad3755d00000000710e"</span>), <span class="code-quote">"x"</span> : [ 1, 2, <span class="code-keyword">null</span>, 4, 3, 2, 3, 4 ] }
</pre>
</div></div></td></tr></tbody></table></div>

<h3><a name="Updating-UpsertswithModifiers"></a>Upserts with Modifiers</h3>

<p>You may use upsert with a modifier operation. In such a case, the modifiers will be applied to the update <tt><em>criteria</em></tt> member and the resulting object will be inserted.  The following upsert example may insert the object {<tt>name:"Joe",x:1,y:1</tt>}.</p>

<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<pre class="code-java">db.people.update( { name:<span class="code-quote">"Joe"</span> }, { $inc: { x:1, y:1 } }, <span class="code-keyword">true</span> );</pre>
</div></div>
<p>There are some restrictions.  A modifier may not reference the <tt>_id</tt> field, and two modifiers within an update may not reference the same field, for example the following is not allowed:</p>

<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<pre class="code-java">db.people.update( { name:<span class="code-quote">"Joe"</span> }, { $inc: { x: 1 }, $set: { x: 5 } } );</pre>
</div></div>

<h3><a name="Updating-PushingaUniqueValue"></a>Pushing a Unique Value</h3>

<p>To add a value to an array only if not already present:</p>

<p>Starting in 1.3.3, you can do</p>
<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<pre class="code-java">update( {_id:'joe'},{<span class="code-quote">"$addToSet"</span>: { tags : <span class="code-quote">"baseball"</span> } } );</pre>
</div></div>
<p>For older versions, add $ne : &lt;value&gt; to your query expression:</p>
<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<pre class="code-java">update( {_id:'joe', tags: {<span class="code-quote">"$ne"</span>: <span class="code-quote">"baseball"</span>}},
        {<span class="code-quote">"$push"</span>: { tags : <span class="code-quote">"baseball"</span> } } );
</pre>
</div></div>

<h2><a name="Updating-CheckingtheOutcomeofanUpdateRequest"></a>Checking the Outcome of an Update Request</h2>

<p>As described above, a non-upsert update may or may not modify an existing object.  An upsert will either modify an existing object or insert a new object.  The client may determine if its most recent message on a connection updated an existing object  by subsequently issuing a <tt>getlasterror</tt> command ( <tt>db.runCommand( "getlasterror" )</tt> ).  If the result of the <tt>getlasterror</tt> command contains an <tt>updatedExisting</tt> field, the last message on the connection was an update request.  If the <tt>updatedExisting</tt> field's value is true, that update request caused an existing object to be updated; if <tt>updatedExisting</tt> is false, no existing object was updated. An <tt>upserted</tt> field will contain the new <tt>_id</tt> value if an insert is performed (new as of 1.5.4).</p>

<h2><a name="Updating-Notes"></a>Notes</h2>

<h3><a name="Updating-ObjectPadding"></a>Object Padding</h3>

<p>When you update an object in MongoDB, the update occurs in-place if the object has not grown in size. This is good for insert performance if the collection has many indexes.</p>

<p>Mongo adaptively learns if objects in a collection tend to grow, and if they do, it adds some padding to prevent excessive movements.&nbsp; This statistic is tracked separately for each collection.</p>


<h3><a name="Updating-Blocking"></a>Blocking</h3>

<p>Staring in 1.5.2, multi updates yield occasionally so you can safely update large amounts of data.  If you want a multi update to be truly atomic, you can use the $atomic flag.</p>
<h2><a name="Updating-SeeAlso"></a>See Also</h2>

<ul>
	<li><a indepth="true" href="findandmodify+command.html" title="findandmodify Command">findandmodify Command</a></li>
	<li><a indepth="true" href="atomic+operations.html" title="Atomic Operations">Atomic Operations</a></li>
</ul>
</div>
</td>
<td class="noprint" align="left" valign="top" width="22%">
<div class="spacetree">
                                            
    

<div class="plugin_pagetree">

        
        
    <ul class="plugin_pagetree_children_list plugin_pagetree_children_list_noleftspace">
        <div class="plugin_pagetree_children">
        </div>
    </ul>

    <fieldset class="hidden">
        <input name="treeId" value="" type="hidden">
        <input name="treeRequestId" value="/plugins/pagetree/naturalchildren.action?decorator=none&amp;excerpt=false&amp;sort=position&amp;reverse=false&amp;disableLinks=false" type="hidden">
        <input name="treePageId" value="1475679" type="hidden">

        <input name="noRoot" value="false" type="hidden">
        <input name="rootPageId" value="131081" type="hidden">

        <input name="rootPage" value="" type="hidden">
        <input name="startDepth" value="0" type="hidden">
        <input name="spaceKey" value="DOCS" type="hidden">

        <input name="i18n-pagetree.loading" value="Loading..." type="hidden">
        <input name="loginUrl" value="/login.action?os_destination=%2Fdisplay%2FDOCS%2FUpdating" type="hidden">

                <fieldset class="hidden">
                                                <input name="ancestorId" value="1475637" type="hidden">
                                    <input name="ancestorId" value="1048712" type="hidden">
                                    <input name="ancestorId" value="131081" type="hidden">
                                    </fieldset>
    </fieldset>
</div>




<p>
</p>
                        <!-- Updating -->
</div>
</td>
</tr>
</tbody></table>
       
       <hr class="grey">
       
       <div class="page-metadata">
    <ul>
                <li class="page-metadata-modification-info">
                    Added by <a class="username:kristina url fn" href="http://www.mongodb.org/display/%7Ekristina">Kristina Chodorow</a>, last edited by <a class="username:mathias url fn" href="http://www.mongodb.org/display/%7Emathias">Mathias Stearn</a> on Aug 05, 2010
                                        <span class="noprint">&nbsp;(<a href="http://www.mongodb.org/pages/diffpages.action?pageId=1475679&amp;originalId=17596628">view change</a>)</span>
                            </li>
                <li class="show-hide-comment-link">
            <a id="show" class="inline-control-link" href="#" onclick="showComment(); return false;">show comment</a>
            <a id="hide" class="inline-control-link" style="display: none;" href="#" onclick="hideComment(); return false;">hide comment</a>
        </li>
            </ul>
      <div id="versionComment" class="noteMacro" style="padding: 5px; display: none;">
      <strong>Comment:</strong>
      emphasize multi flag since it is a common source of confusion<br>
  </div>

    
</div>                          
                           
       <!--
<rdf:RDF xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#"
         xmlns:dc="http://purl.org/dc/elements/1.1/"
         xmlns:trackback="http://madskills.com/public/xml/rss/module/trackback/">
         <rdf:Description
    rdf:about="http://www.mongodb.org/display/DOCS/Updating"
    dc:identifier="http://www.mongodb.org/display/DOCS/Updating"
    dc:title="Updating"
    trackback:ping="http://www.mongodb.org/rpc/trackback/1475679"/>
</rdf:RDF>
-->
       
           
    
    
    


<fieldset class="hidden parameters">
    <legend>Labels parameters</legend>
    <input id="editLabel" value="Edit" type="hidden">
    <input id="addLabel" value="Add Labels" type="hidden">
    <input id="domainName" value="http://www.mongodb.org" type="hidden">
    <input id="pageId" value="1475679" type="hidden">
    <input id="spaceKey" value="DOCS" type="hidden">
</fieldset>

<div id="labels-section" class="pageSection">
    <div id="default-labels-header" class="section-header">
        <h2 id="labels-section-title" class="section-title ">Labels</h2>
            </div>

    <div class="labels-editor">
        <div id="labelsList">
            <div id="label-4718593" class="confluence-label">
    <a class="label" rel="nofollow" href="http://www.mongodb.org/label/DOCS/operators">operators</a>    <span class="remove-label-caption">operators</span>
    <a class="remove-label" href="#">Delete</a>
</div>
<div id="label-4718594" class="confluence-label">
    <a class="label" rel="nofollow" href="http://www.mongodb.org/label/DOCS/%24">$</a>    <span class="remove-label-caption">$</span>
    <a class="remove-label" href="#">Delete</a>
</div>
<div id="label-7340060" class="confluence-label">
    <a class="label" rel="nofollow" href="http://www.mongodb.org/label/DOCS/updates">updates</a>    <span class="remove-label-caption">updates</span>
    <a class="remove-label" href="#">Delete</a>
</div>
<div id="label-7340061" class="confluence-label">
    <a class="label" rel="nofollow" href="http://www.mongodb.org/label/DOCS/inc">inc</a>    <span class="remove-label-caption">inc</span>
    <a class="remove-label" href="#">Delete</a>
</div>
<div id="label-7340062" class="confluence-label">
    <a class="label" rel="nofollow" href="http://www.mongodb.org/label/DOCS/set">set</a>    <span class="remove-label-caption">set</span>
    <a class="remove-label" href="#">Delete</a>
</div>
<div id="label-7340063" class="confluence-label">
    <a class="label" rel="nofollow" href="http://www.mongodb.org/label/DOCS/push">push</a>    <span class="remove-label-caption">push</span>
    <a class="remove-label" href="#">Delete</a>
</div>
<div id="label-7340064" class="confluence-label">
    <a class="label" rel="nofollow" href="http://www.mongodb.org/label/DOCS/upsert">upsert</a>    <span class="remove-label-caption">upsert</span>
    <a class="remove-label" href="#">Delete</a>
</div>
        </div>

        <span class="errorMessage error" id="errorSpan"></span>
        <form method="GET" action="http://www.mongodb.org/display/DOCS/Updating" id="add-labels-form">
            <div id="labelInputSpan" class="labels-input">
                <div id="labelOperationErrorContainer" class="hidden">
                    <span class="error"><span class="errorMessage" id="labelOperationErrorMessage"></span></span>
                </div>

                <div class="caption">Enter labels to add to this page:</div>

                <input autocomplete="off" id="labelsString" name="labelsString" value="" size="40">
                <input class="add-labels" value="Add" type="submit">
                <input class="hide-labels-editor" value="Done" type="submit">
                <div id="waitImageAndStatus">
                    <img class="waiting" alt="Please wait" src="wait.gif">&nbsp;
                    <span id="labelOperationStatus" class="smalltext"></span>
                </div>
                <div class="auto_complete" id="labelsAutocompleteList"></div>
                <div class="labels-tip">
                    <div id="suggestedLabelsSpan"></div>
                    Looking for a label? Just start typing.
                </div>
            </div>
        </form>
    </div>
</div>
       
                   <div id="children-section" class="pageSection">
        
        <div class="section-header ">
            <h2 id="children-section-title" class="section-title">
                <a name="children">Children (3)</a>
            </h2>
            <span class="noprint">
                &nbsp;
                                    <a id="hide-children-link" class="grey" href="http://www.mongodb.org/display/DOCS/Updating?showChildren=false#children">Hide Children</a>
                
                &nbsp;|&nbsp; <a class="grey" href="http://www.mongodb.org/pages/listpages-dirview.action?key=DOCS&amp;openId=1475679#selectedPageInHierarchy">View in Hierarchy</a>
                            </span>
        </div>
                    <div id="page-children" class="pageSectionBody">
                                                     <img src="docs_16.gif" title="Atomic Operations" align="absmiddle" border="0" height="16" width="16">
                         <a indepth="true" href="atomic+operations.html">Atomic Operations</a>
                             <br>
                                                     <img src="docs_16.gif" title="findandmodify Command" align="absmiddle" border="0" height="16" width="16">
                         <a indepth="true" href="findandmodify+command.html">findandmodify Command</a>
                             <br>
                                                     <img src="docs_16.gif" title="Updating Data in Mongo" align="absmiddle" border="0" height="16" width="16">
                         <a indepth="true" href="updating+data+in+mongo.html">Updating Data in Mongo</a>
                             <br>
                            </div>
                </div>
           
           

<!--
    Root decorator: this is a layer of abstraction that Confluence doesn't need. It will be removed eventually.
-->




    
        
    
    


<fieldset class="parameters hidden">
    <input id="deleteCommentConfirmMessage" value="Are you sure you want to remove the comment?" type="hidden">
    <input id="collapseTooltip" value="Click to toggle the display of this comment." type="hidden">
</fieldset>





<div id="comments-section" class="pageSection">
    
            <div class="section-header">
            <ul id="comment-top-links" class="global-comment-actions">
                <li id="comments-expand-collapse">
                    <a href="#" id="comments-collapse">Collapse All</a>
                    <span id="collapse-wait" class="hidden">Collapsing…</span>
                    <span id="expand-wait" class="hidden">Expanding…</span>
                    <a href="#" class="hidden" id="comments-expand">Expand All</a>
                </li>
            </ul>
        </div>
            <!-- added by Kristina 1/7/10 -->
<p>
<b><a style="color: rgb(55, 95, 160);" href="http://groups.google.com/group/mongodb-user">PLEASE POST QUESTIONS IN  THE USER GROUPS FORUM</a>.</b> 
Post non-question comments and helpful hints here.
</p>
            <!-- end -->
<div id="disqus_thread"></div><a href="http://disqus.com/" class="dsq-brlink">blog comments powered by <span class="logo-disqus">Disqus</span></a>
    
    
    
                </div>




       
                                    
       </div>
    <br class="clear">
  </div>
</div>

<div class="sponsor">Copyright © <a class="smalltext" href="http://www.10gen.com/">10gen</a>, Inc. All Rights Reserved | Licensed under <a href="http://creativecommons.org/licenses/by-nc-sa/3.0/">Creative Commons</a></div>







<div id="footer">
                    <ul id="poweredby">
        <li class="noprint">Powered by <a href="http://www.atlassian.com/software/confluence" class="smalltext">Atlassian Confluence</a> 3.0.0_01, the <a href="http://www.atlassian.com/software/confluence" class="smalltext">Enterprise Wiki</a>.</li>
        <li class="print-only">Printed by Atlassian Confluence 3.0.0_01, the Enterprise Wiki.</li>
        <li class="noprint"><a href="http://jira.atlassian.com/secure/BrowseProject.jspa?id=10470" class="smalltext">Bug/feature request</a> –</li>
        <li class="noprint"><a href="http://www.atlassian.com/about/connected.jsp?s_kwcid=Confluence-stayintouch" class="smalltext">Atlassian news</a> –</li>
        <li class="noprint"><a href="http://www.mongodb.org/administrators.action">Contact administrators</a></li>
    </ul>
</div>


</body></html>
