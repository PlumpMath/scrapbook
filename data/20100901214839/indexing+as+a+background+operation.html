<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>


<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">



            <title>Indexing as a Background Operation - MongoDB</title>
    
        
        
        
        
        

                        
    
    
            
<meta id="confluence-context-path" name="confluence-context-path" content="">
<meta id="atlassian-token" name="atlassian-token" content="yhfQmnp0a3">
<meta id="confluence-space-key" name="confluence-space-key" content="DOCS">



    

<!-- include system resources -->

<!--[if IE]>
<link type="text/css" rel="stylesheet" href="/s/1627/3/1.0/_/download/batch/confluence.web.resources:master-styles/confluence.web.resources:master-styles.css?ieonly=true" media="all"/>
<![endif]-->





<!--[if IE]>
<link type="text/css" rel="stylesheet" href="/s/1627/3/1.0/_/download/batch/confluence.macros.profile:profile-macro-styles/confluence.macros.profile:profile-macro-styles.css?ieonly=true" media="all"/>
<![endif]-->



















<!--[if IE]>
<link type="text/css" rel="stylesheet" href="/s/1627/3/1.0/_/download/batch/confluence.web.resources:comments/confluence.web.resources:comments.css?ieonly=true" media="all"/>
<![endif]-->







<!--[if IE]>
<link type="text/css" rel="stylesheet" href="/s/1627/3/1.0.2/_/download/batch/com.atlassian.auiplugin:dialog/com.atlassian.auiplugin:dialog.css?ieonly=true" media="all"/>
<![endif]-->






<!--[if IE]>
<link type="text/css" rel="stylesheet" href="/s/1627/3/1.0/_/download/batch/confluence.web.resources:userlink/confluence.web.resources:userlink.css?ieonly=true" media="all"/>
<![endif]-->




<!-- end system resources -->

    

    <meta name="confluence-request-time" content="1283349198745">

    <link rel="shortcut icon" href="favicon.ico">
    <link rel="icon" type="image/png" href="confluence_16.png">

<link rel="search" type="application/opensearchdescription+xml" href="http://www.mongodb.org/opensearch/osd.action" title="10gen Confluence">

    
        
        
    
    <link rel="shortcut icon" href="favicon_001.ico">  

<link rel="stylesheet" type="text/css" href="indexing+as+a+background+operation.css" media="all">
</head><body id="com-atlassian-confluence">
    


    

        
  
    


  <div id="top-right">
    <div class="user-right">
    <ul id="header-menu-bar" class="ajs-menu-bar">
                    
        
            <li class="normal ajs-menu-item">
        <a id="browse-menu-link" class="browse trigger ajs-menu-title" href="#"><span><span>Browse</span></span></a>         <div class="hidden ajs-drop-down">
                        <ul id="browse-menu-link-leading" class="section-leading first">
                                        <li>
    
    <a id="space-pages-link" href="http://www.mongodb.org/pages/listpages.action?key=DOCS" class="">
                   <span>Pages</span>            </a>
</li>
                                        <li>
    
    <a id="space-blogposts-link" href="http://www.mongodb.org/pages/viewrecentblogposts.action?key=DOCS" class="">
                   <span>News</span>            </a>
</li>
                                        <li>
    
    <a id="space-labels-link" href="http://www.mongodb.org/labels/listlabels-heatmap.action?key=DOCS" class="">
                   <span>Labels</span>            </a>
</li>
                                        <li>
    
    <a id="space-attachments-link" href="http://www.mongodb.org/spaces/listattachmentsforspace.action?key=DOCS" class="">
                   <span>Attachments</span>            </a>
</li>
                                        <li>
    
    <a href="http://www.mongodb.org/spaces/space-bookmarks.action?spaceKey=DOCS" class="">
                   <span>Bookmarks</span>            </a>
</li>
                                        <li>
    
    <a id="space-mail-link" href="http://www.mongodb.org/spaces/viewmailarchive.action?key=DOCS" class="">
                   <span>Mail</span>            </a>
</li>
                                        <li>
    
    <a id="space-advanced-link" href="http://www.mongodb.org/spaces/viewspacesummary.action?key=DOCS" class="">
                   <span>Advanced</span>            </a>
</li>
                            </ul>
                    </div>
    </li>
        
                                                         <li class="ajs-menu-item normal">
    
    <a id="login-link" href="http://www.mongodb.org/login.action?os_destination=%2Fdisplay%2FDOCS%2FIndexing%2Bas%2Ba%2BBackground%2BOperation" class="user-item login-link">
                   <span>Log In</span>            </a>
</li>
                            </ul>
    </div>
  </div>
  

      <div class="search-db">
      <form id="quick-search" class="quick-search" method="get" action="http://www.mongodb.org/dosearchsite.action">
                <fieldset>
            <legend>Quick Search</legend>
            <input value="" class="quick-search-query" id="quick-search-query" accesskey="q" autocomplete="off" name="queryString" size="25" type="text">
            <input class="quick-search-submit" id="quick-search-submit" value="Search" type="submit">
        </fieldset>
        <fieldset class="hidden parameters">
            <input class="quickSearchPlaceholder" id="quickSearchPlaceholder" value="Search" type="hidden">

            <input id="quickNavEnabled" value="true" type="hidden">
             <!-- Quick nav disabled. SettingsManager could not be found -->         </fieldset>
    </form>
      </div>  


  <div id="header-db" class="spread">
    <div class="split">
    	<div id="logo">
    		<div><a href="http://www.mongodb.org/"><img src="logo-mongodb.png" alt="mongoDB" height="90" width="217"></a></div>
    	</div>
    	<div id="nav">
    	</div>
    </div>
  </div>

  <div id="breadcrumbsback" class="spread">
    <div class="split">

    
    <ol id="breadcrumbs">
                                                
            <li><span>
                                                    <a href="http://www.mongodb.org/display/DOCS">MongoDB</a>
                        </span></li>
                                                                    <li id="ellipsis" title="    …
                    Home
        …"><span><strong>…</strong></span></li>
                                                
            <li class="hidden-crumb"><span>
                                                    <a indepth="true" href="home.html">Home</a>
                        </span></li>
                                            
            <li><span>
                                                    <a indepth="true" href="index.html">Developer Zone</a>
                        </span></li>
                                            
            <li><span>
                                                    <a indepth="true" href="manual.html">Manual</a>
                        </span></li>
                                            
            <li><span>
                                                    <a indepth="true" href="indexes.html">Indexes</a>
                        </span></li>
                                            
            <li><span>
                                                    Indexing as a Background Operation
                        </span></li>
                </ol>
 
    </div>
  </div>

  <div id="main-db" class="spread">
    <div class="split">
    
                <ul id="user-control-panel">
                                
            <li class="first"><a href="http://www.mongodb.org/login.action?os_destination=%2Fdisplay%2FDOCS%2FIndexing%2Bas%2Ba%2BBackground%2BOperation">Log In</a></li>

                                                        </ul>
        <div>
    
    <div id="navigation" class="content-navigation view">
        <fieldset class="hidden parameters">
            <input id="pageId" value="5800131" type="hidden">
        </fieldset>
        <ul class="ajs-menu-bar">
                                
            <li class="normal ajs-menu-item">
        <a id="add-menu-link" class="add trigger ajs-menu-title" href="#"><span><span>Add</span></span></a>         <div class="hidden ajs-drop-down">
                        <ul id="add-menu-link-page" class="section-page first">
                                        <li>
    
    <a id="add-comment-menu-link" href="http://www.mongodb.org/display/DOCS/Indexing+as+a+Background+Operation?showComments=true&amp;showCommentArea=true#addcomment" class="add-comment">
                   <span>Comment</span>            </a>
</li>
                            </ul>
                    </div>
    </li>
                    
            <li class="normal ajs-menu-item">
        <a id="action-menu-link" class="action trigger ajs-menu-title" href="#"><span><span>Tools</span></span></a>         <div class="hidden ajs-drop-down">
                        <ul id="action-menu-link-primary" class="section-primary first">
                                        <li>
    
    <a id="view-attachments-link" href="http://www.mongodb.org/pages/viewpageattachments.action?pageId=5800131" class="action-view-attachments" accesskey="a">
                   <span><u>A</u>ttachments (0)</span>            </a>
</li>
                                        <li>
    
    <a id="action-view-history-link" href="http://www.mongodb.org/pages/viewpreviousversions.action?pageId=5800131" class="action-view-history">
                   <span>Page History</span>            </a>
</li>
                            </ul>
                        <ul id="action-menu-link-secondary" class="section-secondary">
                                        <li>
    
    <a id="view-page-info-link" href="http://www.mongodb.org/pages/viewinfo.action?pageId=5800131" class="action-view-info" accesskey="i">
                   <span><u>I</u>nfo</span>            </a>
</li>
                                        <li>
    
    <a id="action-view-source-link" href="http://www.mongodb.org/pages/viewpagesrc.action?pageId=5800131" class="action-view-source popup-link">
                   <span>View Wiki Markup</span>            </a>
</li>
                                        <li>
    
    <a href="http://www.mongodb.org/spaces/flyingpdf/pdfpageexport.action?pageId=5800131&amp;atl_token=yhfQmnp0a3" class="">
                   <span>Export to PDF</span>            </a>
</li>
                                        <li>
    
    <a id="action-export-word-link" href="http://www.mongodb.org/exportword?pageId=5800131" class="action-export-word">
                   <span>Export to Word</span>            </a>
</li>
                            </ul>
                    </div>
    </li>
            </ul>
    </div>

    </div>
    <h1 id="title-heading" class="pagetitle">
                            
		<span id="title-text">
					            <a indepth="true" href="indexing+as+a+background+operation.html">Indexing as a Background Operation</a>
    				</span>
    </h1>

    <!--
    Root decorator: this is a layer of abstraction that Confluence doesn't need. It will be removed eventually.
-->




    
    

    
    
        
    
    
                    
    



        
<div id="content" class="page view">
            
        
                        
                                
    
        
                    
        
                

 
<table cellpadding="5" cellspacing="2">
<tbody><tr>
<td class="pagecontent" align="left" valign="top" width="78%">
<div class="wiki-content">
<!-- wiki content -->
            <div class="panelMacro"><table class="noteMacro"><colgroup><col width="24"><col></colgroup><tbody><tr><td valign="top"><img src="warning.gif" alt="" align="absmiddle" border="0" height="16" width="16"></td><td>Slaves and replica secondaries build all indexes in the foreground in certain releases (including the latest).  Thus even when using background:true on the primary, the slave/secondary will be unavailable to service queries while the index builds there.</td></tr></tbody></table></div>

<p>By default the <a indepth="true" href="indexes.html" title="Indexes"><tt>ensureIndex()</tt></a> operation is blocking, and will stop other operations on the database from proceeding until completed.  However, in v1.3.2+, a background indexing option is available.</p>

<p>To build an index in the background, add <tt>background:true</tt> to your index options.  Examples:</p>

<div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<pre class="code-java">&gt; db.things.ensureIndex({x:1}, {background:<span class="code-keyword">true</span>});
&gt; db.things.ensureIndex({name:1}, {background:<span class="code-keyword">true</span>, unique:<span class="code-keyword">true</span>,
... dropDups:<span class="code-keyword">true</span>});
</pre>
</div></div>

<p>With background mode enabled, other operations, including writes, will not be obstructed during index creation.  The index is not used for queries until the build is complete.</p>

<p>Although the operation is 'background' in the sense that other operations may run concurrently, the command will not return to the shell prompt until completely finished. To do other operations at the same time, open a separate mongo <a indepth="true" href="mongo+-+the+interactive+shell.html" title="mongo - The Interactive Shell">shell</a> instance.</p>

<p>Please note that background mode building uses an incremental approach to building the index which is slower than the default foreground mode: time to build the index will be greater.</p>

<p>While the build progresses, it is possible to see that the operation is still in progress with the <tt>db.currentOp()</tt> command (will be shown as an insert to system.indexes).&nbsp; You may also use <tt>db.killOp()</tt> to terminate the build process.</p>

<p>While the build progresses, the index is visible in system.indexes, but it is not used for queries until building completes.</p>

<h4><a name="IndexingasaBackgroundOperation-Notes"></a>Notes</h4>

<ul>
	<li>Only one index build at a time is permitted per collection.</li>
	<li>Some administrative operations, such as <a href="http://www.mongodb.org/display/DOCS/Durability+and+Repair" title="Durability and Repair">repairDatabase</a>, are disallowed while a background indexing job is in progress.</li>
	<li>v1.4 and higher (for production usage)</li>
</ul>
</div>
</td>
<td class="noprint" align="left" valign="top" width="22%">
<div class="spacetree">
                                            
    

<div class="plugin_pagetree">

        
        
    <ul class="plugin_pagetree_children_list plugin_pagetree_children_list_noleftspace">
        <div class="plugin_pagetree_children">
        </div>
    </ul>

    <fieldset class="hidden">
        <input name="treeId" value="" type="hidden">
        <input name="treeRequestId" value="/plugins/pagetree/naturalchildren.action?decorator=none&amp;excerpt=false&amp;sort=position&amp;reverse=false&amp;disableLinks=false" type="hidden">
        <input name="treePageId" value="5800131" type="hidden">

        <input name="noRoot" value="false" type="hidden">
        <input name="rootPageId" value="131081" type="hidden">

        <input name="rootPage" value="" type="hidden">
        <input name="startDepth" value="0" type="hidden">
        <input name="spaceKey" value="DOCS" type="hidden">

        <input name="i18n-pagetree.loading" value="Loading..." type="hidden">
        <input name="loginUrl" value="/login.action?os_destination=%2Fdisplay%2FDOCS%2FIndexing%2Bas%2Ba%2BBackground%2BOperation" type="hidden">

                <fieldset class="hidden">
                                                <input name="ancestorId" value="131518" type="hidden">
                                    <input name="ancestorId" value="1475637" type="hidden">
                                    <input name="ancestorId" value="1048712" type="hidden">
                                    <input name="ancestorId" value="131081" type="hidden">
                                    </fieldset>
    </fieldset>
</div>




<p>
</p>
                        <!-- Indexing as a Background Operation -->
</div>
</td>
</tr>
</tbody></table>
       
       <hr class="grey">
       
       <div class="page-metadata">
    <ul>
                <li class="page-metadata-modification-info">
                    Added by <a class="username:dwight url fn" href="http://www.mongodb.org/display/%7Edwight">Dwight Merriman</a>, last edited by <a class="username:dwight url fn" href="http://www.mongodb.org/display/%7Edwight">Dwight Merriman</a> on Aug 23, 2010
                                        <span class="noprint">&nbsp;(<a href="http://www.mongodb.org/pages/diffpages.action?pageId=5800131&amp;originalId=17596985">view change</a>)</span>
                            </li>
            </ul>
      <div id="versionComment" class="noteMacro" style="padding: 5px; display: none;">
      <strong>Comment:</strong>
      <br>
  </div>

    
</div>                          
                           
       <!--
<rdf:RDF xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#"
         xmlns:dc="http://purl.org/dc/elements/1.1/"
         xmlns:trackback="http://madskills.com/public/xml/rss/module/trackback/">
         <rdf:Description
    rdf:about="http://www.mongodb.org/display/DOCS/Indexing+as+a+Background+Operation"
    dc:identifier="http://www.mongodb.org/display/DOCS/Indexing+as+a+Background+Operation"
    dc:title="Indexing as a Background Operation"
    trackback:ping="http://www.mongodb.org/rpc/trackback/5800131"/>
</rdf:RDF>
-->
       
           
    
    
    


<fieldset class="hidden parameters">
    <legend>Labels parameters</legend>
    <input id="editLabel" value="Edit" type="hidden">
    <input id="addLabel" value="Add Labels" type="hidden">
    <input id="domainName" value="http://www.mongodb.org" type="hidden">
    <input id="pageId" value="5800131" type="hidden">
    <input id="spaceKey" value="DOCS" type="hidden">
</fieldset>

<div id="labels-section" class="pageSection">
    <div id="default-labels-header" class="section-header">
        <h2 id="labels-section-title" class="section-title  hidden ">Labels</h2>
            </div>

    <div class="labels-editor">
        <div id="labelsList">
                    </div>

        <span class="errorMessage error" id="errorSpan"></span>
        <form method="GET" action="http://www.mongodb.org/display/DOCS/Indexing+as+a+Background+Operation" id="add-labels-form">
            <div id="labelInputSpan" class="labels-input">
                <div id="labelOperationErrorContainer" class="hidden">
                    <span class="error"><span class="errorMessage" id="labelOperationErrorMessage"></span></span>
                </div>

                <div class="caption">Enter labels to add to this page:</div>

                <input autocomplete="off" id="labelsString" name="labelsString" value="" size="40">
                <input class="add-labels" value="Add" type="submit">
                <input class="hide-labels-editor" value="Done" type="submit">
                <div id="waitImageAndStatus">
                    <img class="waiting" alt="Please wait" src="wait.gif">&nbsp;
                    <span id="labelOperationStatus" class="smalltext"></span>
                </div>
                <div class="auto_complete" id="labelsAutocompleteList"></div>
                <div class="labels-tip">
                    <div id="suggestedLabelsSpan"></div>
                    Looking for a label? Just start typing.
                </div>
            </div>
        </form>
    </div>
</div>
       
                  
           

<!--
    Root decorator: this is a layer of abstraction that Confluence doesn't need. It will be removed eventually.
-->




    
        
    
    


<fieldset class="parameters hidden">
    <input id="deleteCommentConfirmMessage" value="Are you sure you want to remove the comment?" type="hidden">
    <input id="collapseTooltip" value="Click to toggle the display of this comment." type="hidden">
</fieldset>





<div id="comments-section" class="pageSection">
    
            <div class="section-header">
            <ul id="comment-top-links" class="global-comment-actions">
                <li id="comments-expand-collapse">
                    <a href="#" id="comments-collapse">Collapse All</a>
                    <span id="collapse-wait" class="hidden">Collapsing…</span>
                    <span id="expand-wait" class="hidden">Expanding…</span>
                    <a href="#" class="hidden" id="comments-expand">Expand All</a>
                </li>
            </ul>
        </div>
            <!-- added by Kristina 1/7/10 -->
<p>
<b><a style="color: rgb(55, 95, 160);" href="http://groups.google.com/group/mongodb-user">PLEASE POST QUESTIONS IN  THE USER GROUPS FORUM</a>.</b> 
Post non-question comments and helpful hints here.
</p>
            <!-- end -->
<div id="disqus_thread"></div><a href="http://disqus.com/" class="dsq-brlink">blog comments powered by <span class="logo-disqus">Disqus</span></a>
    
    
    
                </div>




       
                                    
       </div>
    <br class="clear">
  </div>
</div>

<div class="sponsor">Copyright © <a class="smalltext" href="http://www.10gen.com/">10gen</a>, Inc. All Rights Reserved | Licensed under <a href="http://creativecommons.org/licenses/by-nc-sa/3.0/">Creative Commons</a></div>







<div id="footer">
                    <ul id="poweredby">
        <li class="noprint">Powered by <a href="http://www.atlassian.com/software/confluence" class="smalltext">Atlassian Confluence</a> 3.0.0_01, the <a href="http://www.atlassian.com/software/confluence" class="smalltext">Enterprise Wiki</a>.</li>
        <li class="print-only">Printed by Atlassian Confluence 3.0.0_01, the Enterprise Wiki.</li>
        <li class="noprint"><a href="http://jira.atlassian.com/secure/BrowseProject.jspa?id=10470" class="smalltext">Bug/feature request</a> –</li>
        <li class="noprint"><a href="http://www.atlassian.com/about/connected.jsp?s_kwcid=Confluence-stayintouch" class="smalltext">Atlassian news</a> –</li>
        <li class="noprint"><a href="http://www.mongodb.org/administrators.action">Contact administrators</a></li>
    </ul>
</div>


</body></html>
